% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/initialize.R
\name{augment_iea_df}
\alias{augment_iea_df}
\title{Augment an IEA data frame}
\usage{
augment_iea_df(.iea_df, country = "Country",
  ledger_side = "Ledger.side",
  flow_aggregation_point = "Flow.aggregation.point", flow = "Flow",
  product = "Product", energy_type = "Energy.type",
  energy_type_val = "E", method = "Method", method_val = "PCM",
  last_stage = "Last.stage", last_stage_val = "Final", unit = "Unit",
  unit_val = "ktoe", supply = "Supply", consumption = "Consumption",
  tpes = "Total primary energy supply", tpes_flows = c("Production",
  "Imports", "Exports", "International marine bunkers",
  "International aviation bunkers", "Stock changes"),
  tfc_compare = "TFC compare",
  tfc_compare_flows = c("Total primary energy supply", "Transfers",
  "Statistical differences", "Transformation processes",
  "Energy industry own use", "Losses"), transfers = "Transfers",
  statistical_differences = "Statistical differences",
  losses = "Losses",
  transformation_processes = "Transformation processes",
  tp_flows_suffix = "(transf.)",
  nstp_flows_suffix = "(transformation)",
  eiou = "Energy industry own use", eiou_flows_suffix = "(energy)",
  tfc = "Total final consumption", tfc_flows = c("Industry",
  "Transport", "Other", "Non-energy use"), industry = "Industry",
  industry_flows = c("Iron and steel", "Chemical and petrochemical",
  "Non-ferrous metals", "Non-metallic minerals", "Transport equipment",
  "Machinery", "Mining and quarrying", "Food and tobacco",
  "Paper, pulp and print", "Wood and wood products", "Construction",
  "Textile and leather", "Non-specified (industry)"),
  transport = "Transport",
  transport_flows = c("World aviation bunkers", "Domestic aviation",
  "Road", "Rail", "Pipeline transport", "World marine bunkers",
  "Domestic navigation", "Non-specified (transport)"), other = "Other",
  other_flows = c("Residential", "Commercial and public services",
  "Agriculture/forestry", "Fishing", "Non-specified (other)"),
  non_energy = "Non-energy use", non_energy_prefix = "Non-energy use",
  electricity_output = "Electricity output (GWh)",
  electricity_output_flows_prefix = "Electricity output (GWh)-",
  heat_output = "Heat output",
  heat_output_flows_prefix = "Heat output-", .rownum = ".rownum")
}
\arguments{
\item{.iea_df}{a data frame produced by the \code{\link[=iea_df]{iea_df()}} function}

\item{country}{the name of the country column in \code{.iea_df}. Default is "\code{Country}".}

\item{ledger_side}{the name of the ledger side column to be added to \code{.iea_df}. Default is "\code{Ledger.side}".}

\item{flow_aggregation_point}{the name of the flow aggregation point column to be added to \code{.iea_df}. Default is "\code{Flow.aggregation.point}".}

\item{flow}{the name of the flow column in \code{.iea_df}.  Default is "\code{Flow}".}

\item{product}{the name of the product column in \code{.iea_df}.  Default is "\code{Product}".}

\item{energy_type}{the name of the energy type column to be added to \code{.iea_df}. Default is "\code{Energy.type}.}

\item{energy_type_val}{the value to put in the \code{energy_type} column. Default is "\code{E}".}

\item{method}{the name of the method column to be added to \code{.iea_df}. Default is "\code{Method}.}

\item{method_val}{the value to put in the \code{method} column. Default is "\code{PCM}" (Physical Content Method, which is used by the IEA).}

\item{last_stage}{the name of the last stage column to be added to \code{.iea_df}. Default is "\code{Last.stage}.}

\item{last_stage_val}{the value to put in the \code{last_stage} column. Default is "\code{Final}" (which is the last stage supplied by the IEA).}

\item{unit}{the name of the unit column to be added to \code{.iea_df}. Default is "\code{Unit}".}

\item{unit_val}{the value to put in the \code{unit} column. Default is "\code{ktoe}" for kilotons of oil equivalent.}

\item{supply}{the string that identifies supply \code{Ledger.side}. Default is "\code{Supply}".}

\item{consumption}{the string that identifies consumption \code{Ledger.side}. Default is "\code{Consumption}".}

\item{tpes}{the string that identifies total primary energy supply \code{Flow.aggregation.point}. Default is "\code{Total primary energy supply}.}

\item{tpes_flows}{a vector of strings that give flows that are aggregated to \code{Total primary energy supply}.}

\item{tfc_compare}{a string that identifies the \code{TFC compare} flow aggregation point. Default is \code{TFC compare}.}

\item{tfc_compare_flows}{a vector of strings that give \code{Flow}s that are aggregated to \code{TFC compare}.}

\item{transfers}{= a string that identifies transfers in the flow column. Default is "\code{Transfers}".}

\item{statistical_differences}{a string that identifies statistical differences in flow column. Default is "\code{Statistical differences}".}

\item{losses}{the string that indicates losses in the \code{Flow} column. Default is "\code{Losses}".}

\item{transformation_processes}{the string that indicates transformation processes in the \code{Flow} column. Default is "\code{Transformation processes}".}

\item{tp_flows_suffix}{the suffix for transformation processes in the \code{Flow} column. Default is "\code{(transf.)}".}

\item{nstp_flows_suffix}{the suffix for non-specified transformation processes in the \code{Flow} column. Default is "\code{(transformation)}".}

\item{eiou}{the string that identifies energy industry own use in the \code{Flow} column. Default is "\code{Energy industry own use}".}

\item{eiou_flows_suffix}{the suffix for energy industry own use in the \code{Flow} column. Default is "\code{(energy)}".}

\item{tfc}{the string that identifies total final consumption in the \code{Flow} column. Default is "\code{Total final consumption}".}

\item{tfc_flows}{a vector of strings that give total final consumption in the \code{Flow} column.}

\item{industry}{a string that names the industry \code{Flow.aggregation.point}. Default is "\code{Industry}".}

\item{industry_flows}{a vector of strings representing \code{Flow}s to be aggregated in the \code{Industry} \code{Flow.aggregation.point}.}

\item{transport}{a string that names the transport \code{Flow.aggregation.point}. Default is "\code{Transport}".}

\item{transport_flows}{a vector of strings representing \code{Flow}s to be aggregated in the \code{Transport} \code{Flow.aggregation.point}.}

\item{other}{a string that names the other \code{Flow.aggregation.point}. Default is "\code{Other}".}

\item{other_flows}{a vector of strings representing \code{Flow}s to be aggregated in the \code{Other} \code{Flow.aggregation.point}.}

\item{non_energy}{a string that names the non-energy \code{Flow.aggregation.point}. Default is "\code{Non-energy use}".}

\item{non_energy_prefix}{a string prefix for \code{Flow}s to be aggregated in the \code{Non-energy use} \code{Flow.aggregation.point}.}

\item{electricity_output}{a string that names the electricity output \code{Flow}. Default is "\code{Electricity output (GWh)}".}

\item{electricity_output_flows_prefix}{a string prefix for \code{Flow}s to be aggregated in electricity output. Default is "\code{Electricity output (GWh)-}".}

\item{heat_output}{a string that names the heat output \code{Flow}. Default is "\code{Heat output}".}

\item{heat_output_flows_prefix}{a string prefix for \code{Flow}s to be aggregated in heat output. Default is "\code{Heat output-}".}

\item{.rownum}{the name of a column created (and destroyed) internally by this function.
The \code{.rownum} column temporarily holds row numbers for internal calculations.
The \code{.rownum} column is deleted before returning.}
}
\value{
\code{.iea_df} with additional columns named \code{ledger_side}, \code{flow_aggregation_point}, \code{energy_type}, and \code{unit}.
}
\description{
This function prepares an IEA data frame created by \code{\link[=iea_df]{iea_df()}} for use in R.
}
\details{
This function solves several problems.
The first problem is that metadata in the \code{COUNTRY}, \code{FLOW}, and \code{PRODUCT}
columns of an IEA data table are not unique.
A second problem is that the \code{FLOW} column contains both industries to which energy is flowing \emph{and}
the type of flow that is involved.
(E.g., the suffix "\code{(energy)}" means that the flow is an own use by the energy industry.
The "\code{(transf.)}" suffix means that a flow is involved in a transformation process
between primary and final energy.

To solve these problems, two additional columns are added: \code{Ledger.side} and \code{Flow.aggregation.point}.
\code{Ledger.side} can be one of "\code{Supply}" or "\code{Consumption}", corresponding to the top or bottom of the IEA's tables, respectively.
\code{Flow.aggregation.point} indicates the next level of aggregation for these data.
\code{Flow.aggregation.point} can be one of
"\code{Total primary energy supply}", "\code{Transformation processes}", "\code{Energy industry own use}", or "\code{TFC compare}"
on the \code{Supply} side of the ledger.
On the \code{Consumption} side of the ledger, \code{Flow.aggregation.point} can be one of
"\code{Industry}", "\code{Transport}", "\code{Other}", or "\code{Non-energy use}".
When the \code{Flow.aggregation.point} column is present,
the need for the "\code{(energy)}" and "\code{(transf.)}" suffixes is eliminated,
so they are deleted.

The third problem this function solves is that energy type and units are not specified in IEA data.
An \code{Energy.type} column is added with the value of \code{energy_type_val}.
(Default is \code{E}, for energy, as opposed to \code{X}, which would be exergy.)
A \code{Unit} column is added with the value of \code{unit_val}.
(Default is \code{ktoe}, although any string can be specified in \code{unit_val}.)

Note that this function decides where to divide \code{Supply} from \code{Consumption}.
To do so, it first looks for rows in which \code{Flow} is "\code{Losses}".
The last "\code{Losses}" row is the last row of the \code{Supply} side of the ledger.
If "\code{Losses}" rows are not found, the function looks for rows in which \code{Flow} is "\code{Total final consumption}".
The first "\code{Total final consumption}" row is the first row of the \code{Consumption} side of the ledger.
If neither "\code{Losses}" nor "\code{Total final consumption}" \code{Flow}s are present,
an error is generated.
}
\examples{
iea_df(text = paste0(",,TIME,1960,1961\\n",
                       "COUNTRY,FLOW,PRODUCT\\n",
                       "World,Production,Hard coal (if no detail),42,43\\n",
                       "World,Losses,Hard coal (if no detail),1,2")) \%>\% 
  rename_iea_df_cols() \%>\% 
  augment_iea_df()
}
