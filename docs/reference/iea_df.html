<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Load IEA data from an extended energy balances .csv file — iea_df • IEATools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Load IEA data from an extended energy balances .csv file — iea_df"><meta name="description" content="If .slurped_iea_df is supplied, arguments .iea_file or text are ignored.
If .slurped_iea_df is absent,
either .iea_file or text are required, and
the helper function slurp_iea_to_raw_df() is called internally
to load a raw data frame of data."><meta property="og:description" content="If .slurped_iea_df is supplied, arguments .iea_file or text are ignored.
If .slurped_iea_df is absent,
either .iea_file or text are required, and
the helper function slurp_iea_to_raw_df() is called internally
to load a raw data frame of data."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">IEATools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.79</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/IEATools.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/final_to_useful.html">Final to Useful Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/fix_iea_data.html">Fixes for IEA Data</a></li>
    <li><a class="dropdown-item" href="../articles/prep_psut.html">Prepare for PSUT analysis</a></li>
    <li><a class="dropdown-item" href="../articles/psut_names.html">PSUT Names</a></li>
    <li><a class="dropdown-item" href="../articles/specify.html">Specify EIOU Industries and Flows</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Load IEA data from an extended energy balances .csv file</h1>

      <div class="d-none name"><code>iea_df.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>If <code>.slurped_iea_df</code> is supplied, arguments <code>.iea_file</code> or <code>text</code> are ignored.
If <code>.slurped_iea_df</code> is absent,
either <code>.iea_file</code> or <code>text</code> are required, and
the helper function <code><a href="slurp_iea_to_raw_df.html">slurp_iea_to_raw_df()</a></code> is called internally
to load a raw data frame of data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">iea_df</span><span class="op">(</span></span>
<span>  .iea_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  text <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  expected_1st_line_start <span class="op">=</span> <span class="st">",,TIME"</span>,</span>
<span>  expected_2nd_line_start <span class="op">=</span> <span class="st">"COUNTRY,FLOW,PRODUCT"</span>,</span>
<span>  expected_simple_start <span class="op">=</span> <span class="va">expected_2nd_line_start</span>,</span>
<span>  .slurped_iea_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  flow <span class="op">=</span> <span class="st">"FLOW"</span>,</span>
<span>  missing_data <span class="op">=</span> <span class="st">".."</span>,</span>
<span>  not_applicable_data <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  confidential_data <span class="op">=</span> <span class="st">"c"</span>,</span>
<span>  estimated_year <span class="op">=</span> <span class="st">"E"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--iea-file">.iea_file<a class="anchor" aria-label="anchor" href="#arg--iea-file"></a></dt>
<dd><p>A string containing the path to a .csv file of extended energy balances from the IEA.
Can be a vector of file paths, in which case
each file is loaded sequentially and stacked together
with <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">dplyr::bind_rows()</a></code>.
Default is the path to a sample IEA file provided in this package.</p></dd>


<dt id="arg-text">text<a class="anchor" aria-label="anchor" href="#arg-text"></a></dt>
<dd><p>A character string that can be parsed as IEA extended energy balances.
(This argument is useful for testing.)</p></dd>


<dt id="arg-expected-st-line-start">expected_1st_line_start<a class="anchor" aria-label="anchor" href="#arg-expected-st-line-start"></a></dt>
<dd><p>the expected start of the first line of <code>iea_file</code>. Default is ",,TIME".</p></dd>


<dt id="arg-expected-nd-line-start">expected_2nd_line_start<a class="anchor" aria-label="anchor" href="#arg-expected-nd-line-start"></a></dt>
<dd><p>the expected start of the second line of <code>iea_file</code>. Default is "COUNTRY,FLOW,PRODUCT".</p></dd>


<dt id="arg-expected-simple-start">expected_simple_start<a class="anchor" aria-label="anchor" href="#arg-expected-simple-start"></a></dt>
<dd><p>the expected starting of the first line of <code>iea_file</code>. Default is the value of <code>expected_2nd_line_start</code>.
Note that <code>expected_simple_start</code> is sometimes encountered in data supplied by the IEA.
Furthermore, <code>expected_simple_start</code> could be the format of the file when somebody "helpfully" fiddles with
the raw data from the IEA.</p></dd>


<dt id="arg--slurped-iea-df">.slurped_iea_df<a class="anchor" aria-label="anchor" href="#arg--slurped-iea-df"></a></dt>
<dd><p>a data frame created by <code><a href="slurp_iea_to_raw_df.html">slurp_iea_to_raw_df()</a></code></p></dd>


<dt id="arg-flow">flow<a class="anchor" aria-label="anchor" href="#arg-flow"></a></dt>
<dd><p>the name of the flow column, entries of which are stripped of leading and trailing white space. Default is "FLOW".</p></dd>


<dt id="arg-missing-data">missing_data<a class="anchor" aria-label="anchor" href="#arg-missing-data"></a></dt>
<dd><p>a string that identifies missing data. Default is "<code>..</code>".
Entries of <code>missing_data</code> are coded as `0“ in output.</p></dd>


<dt id="arg-not-applicable-data">not_applicable_data<a class="anchor" aria-label="anchor" href="#arg-not-applicable-data"></a></dt>
<dd><p>a string that identifies not-applicable data. Default is "x".
Entries of <code>not_applicable_data</code> are coded as <code>0</code> in output.</p></dd>


<dt id="arg-confidential-data">confidential_data<a class="anchor" aria-label="anchor" href="#arg-confidential-data"></a></dt>
<dd><p>a string that identifies confidential data. Default is "c".
Entries of <code>confidential_data</code> are coded as <code>0</code> in output.</p></dd>


<dt id="arg-estimated-year">estimated_year<a class="anchor" aria-label="anchor" href="#arg-estimated-year"></a></dt>
<dd><p>a string that identifies an estimated year.
Default is "E".
E.g., in "2014E", the "E" indicates that data for 2014 are estimated.
Data from estimated years are removed from output.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a data frame containing the IEA extended energy balances data</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Next, this function does some cleaning of the data.</p>
<p>In the IEA's data, some entries in the "FLOW" column are quoted to avoid creating too many columns.
For example, "Paper, pulp and printing" is quoted in the raw .csv file:
"      Paper, pulp and printing".
Internally, this function uses <code><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">data.table::fread()</a></code>, which, unfortunately, does not
strip leading and trailing white space from quoted entries.
So the function uses <code><a href="https://rdrr.io/r/base/trimws.html" class="external-link">base::trimws()</a></code> to finish the job.</p>
<p>When the IEA includes estimated data for a year,
the column name of the estimated year includes an "E" appended.
(E.g., "2017E".)
This function eliminates estimated columns.</p>
<p>The IEA data have indicators for
not applicable values ("<code>x</code>") and for
unavailable values ("<code>..</code>").
(See "World Energy Balances: Database Documentation (2018 edition)" at
<a href="http://wds.iea.org/wds/pdf/worldbal_documentation.pdf" class="external-link">http://wds.iea.org/wds/pdf/worldbal_documentation.pdf</a>.)
<code>R</code> has three concepts that could be used for "<code>x</code>" and "<code>..</code>":
<code>0</code> would indicate value known to be zero.
<code>NULL</code> would indicate an undefined value.
<code>NA</code> would indicate a value that is unavailable.
In theory, mapping from the IEA's indicators to <code>R</code> should proceed as follows:
"<code>..</code>" (unavailable) in the IEA data would be converted to <code>NA</code> in <code>R</code>.
"<code>x</code>" (not applicable) in the IEA data would be converted to <code>0</code> in <code>R</code>.
"<code>NULL</code>" would not be used.
However, the IEA are not consistent with their coding.
In some places "<code>..</code>" (indicating unavailable) is used for not applicable values,
e.g., World Anthracite supply in 1971.
(World Anthracite supply in 1971 is actually not applicable, because Anthracite was
classified under "Hard coal (if no detail)" in 1971.)
On the other hand, "<code>..</code>" is used for data in the most recent year
when those data have not yet been incorporated into the database.
In the face of IEA's inconsistencies,
the only rational way to proceed is to convert
both "<code>x</code>" and "<code>..</code>" in the IEA files to "<code>0</code>" in the output data frame
from this function.
Furthermore, confidential data (coded by the IEA as "<code>c</code>") is also interpreted as <code>0</code>.
(What else can we do?)</p>
<p>The data frame returned from this function is not ready to be used in R,
because rows are not unique.
To further prepare the data frame for use, call <code><a href="augment_iea_df.html">augment_iea_df()</a></code>,
passing the output of this function to the <code>.iea_df</code> argument of <code><a href="augment_iea_df.html">augment_iea_df()</a></code>.</p>
<p>This function is vectorized over <code>.iea_file</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Original file format</span></span></span>
<span class="r-in"><span><span class="fu">iea_df</span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">",,TIME,1960,1961\n"</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"COUNTRY,FLOW,PRODUCT\n"</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"World,Production,Hard coal (if no detail),42,43"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   COUNTRY       FLOW                  PRODUCT 1960 1961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   World Production Hard coal (if no detail)   42   43</span>
<span class="r-in"><span><span class="co"># With extra commas on the 2nd line</span></span></span>
<span class="r-in"><span><span class="fu">iea_df</span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">",,TIME,1960,1961\n"</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"COUNTRY,FLOW,PRODUCT,,,\n"</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"World,Production,Hard coal (if no detail),42,43"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   COUNTRY       FLOW                  PRODUCT 1960 1961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   World Production Hard coal (if no detail)   42   43</span>
<span class="r-in"><span><span class="co"># With a clean first line</span></span></span>
<span class="r-in"><span><span class="fu">iea_df</span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"COUNTRY,FLOW,PRODUCT,1960,1961\n"</span>,</span></span>
<span class="r-in"><span>                     <span class="st">"World,Production,Hard coal (if no detail),42,43"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   COUNTRY       FLOW                  PRODUCT 1960 1961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   World Production Hard coal (if no detail)   42   43</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kuperus Heun, Emmanuel Aramendia, Zeke Marshall.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

