<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Final to Useful Analysis • IEATools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Final to Useful Analysis">
<meta property="og:description" content="IEATools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IEATools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.57</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/IEATools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/final_to_useful.html">Final to Useful Analysis</a>
    </li>
    <li>
      <a href="../articles/fix_iea_data.html">Fixes for IEA Data</a>
    </li>
    <li>
      <a href="../articles/prep_psut.html">Prepare for PSUT analysis</a>
    </li>
    <li>
      <a href="../articles/specify.html">Specify EIOU Industries and Flows</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="final_to_useful_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Final to Useful Analysis</h1>
                        <h4 class="author">Matthew Kuperus Heun</h4>
            
            <h4 class="date">2021-08-19</h4>
      
      
      <div class="hidden name"><code>final_to_useful.Rmd</code></div>

    </div>

    
    
<!-- Establish some helpful LaTeX shortcuts for equations -->
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Extended energy balance data from the <a href="https://www.iea.org">International Energy Agency (IEA)</a> provides both primary and final energy information. (Primary energy is extracted from the biosphere, and final energy is sold to consumers.) But consumers don’t buy final energy for its own sake. They buy final energy so they can convert it to useful energy (heat, light, work) that, when combined with infrastructure (buildings, roads, etc.), provides energy services (heated and cooled space, passenger and freight transport, etc.).</p>
<p>So some energy conversion chain analyses extend the final energy provided by the IEA to useful energy through a process that involves</p>
<ol style="list-style-type: lower-alpha">
<li>allocating final energy to final-to-useful energy conversion machines,</li>
<li>defining the efficiency of those final-to-useful energy conversion machines, and</li>
<li>calculating the useful energy injected into the the final demand economic sectors.</li>
</ol>
<p>The <code>IEATools</code> package provides several functions to assist the process of pushing from final energy to useful energy. This vignette demonstrates their use and suggests a workflow for this process.</p>
</div>
<div id="allocation" class="section level2">
<h2 class="hasAnchor">
<a href="#allocation" class="anchor"></a>Allocation</h2>
<p>Extending the IEA’s extended energy balance data to the useful stage begins with defining allocations of final energy carriers to final-to-useful energy conversion machines. To demonstrate this process, we’ll use the sample IEA data bundled with this package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">IEATools</span><span class="op">)</span>
<span class="va">Tidy_iea_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/specify_all.html">specify_all</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Rows: 428</span>
<span class="co">#&gt; Columns: 11</span>
<span class="co">#&gt; $ Country                &lt;chr&gt; "GHA", "GHA", "GHA", "GHA", "GHA", "GHA", "GHA"…</span>
<span class="co">#&gt; $ Method                 &lt;chr&gt; "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span>
<span class="co">#&gt; $ Energy.type            &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span>
<span class="co">#&gt; $ Last.stage             &lt;chr&gt; "Final", "Final", "Final", "Final", "Final", "F…</span>
<span class="co">#&gt; $ Year                   &lt;dbl&gt; 1971, 1971, 1971, 1971, 1971, 1971, 1971, 1971,…</span>
<span class="co">#&gt; $ Ledger.side            &lt;chr&gt; "Consumption", "Consumption", "Consumption", "C…</span>
<span class="co">#&gt; $ Flow.aggregation.point &lt;chr&gt; "Industry", "Industry", "Industry", "Industry",…</span>
<span class="co">#&gt; $ Flow                   &lt;chr&gt; "Industry not elsewhere specified", "Industry n…</span>
<span class="co">#&gt; $ Product                &lt;chr&gt; "Electricity", "Fuel oil", "Gas/diesel oil excl…</span>
<span class="co">#&gt; $ Unit                   &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "ktoe",…</span>
<span class="co">#&gt; $ E.dot                  &lt;dbl&gt; 21.9261, 88.3348, 39.2997, 145.6960, 16.6810, 1…</span></code></pre></div>
<p>The next step is to develop a blank template in which the analyst can provide final-to-useful allocation values (<code>C</code>) in percentages. <code><a href="../reference/fu_allocation_template.html">fu_allocation_template()</a></code> builds a final-to-useful allocation template.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">FU_allocation_template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/specify_all.html">specify_all</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fu_allocation_template.html">fu_allocation_template</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">FU_allocation_template</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Rows: 906</span>
<span class="co">#&gt; Columns: 15</span>
<span class="co">#&gt; $ Country                &lt;chr&gt; "GHA", "GHA", "GHA", "GHA", "GHA", "GHA", "GHA"…</span>
<span class="co">#&gt; $ Method                 &lt;chr&gt; "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span>
<span class="co">#&gt; $ Energy.type            &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span>
<span class="co">#&gt; $ Last.stage             &lt;chr&gt; "Final", "Final", "Final", "Final", "Final", "F…</span>
<span class="co">#&gt; $ Ledger.side            &lt;chr&gt; "Supply", "Supply", "Supply", "Supply", "Supply…</span>
<span class="co">#&gt; $ Flow.aggregation.point &lt;chr&gt; "Energy industry own use", "Energy industry own…</span>
<span class="co">#&gt; $ Unit                   &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "ktoe",…</span>
<span class="co">#&gt; $ Ef.product             &lt;chr&gt; "Refinery gas", "Refinery gas", "Refinery gas",…</span>
<span class="co">#&gt; $ Machine                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</span>
<span class="co">#&gt; $ Eu.product             &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</span>
<span class="co">#&gt; $ Destination            &lt;chr&gt; "Oil refineries", "Oil refineries", "Oil refine…</span>
<span class="co">#&gt; $ Quantity               &lt;chr&gt; "E.dot", "E.dot [%]", "C_1 [%]", "C_2 [%]", "C_…</span>
<span class="co">#&gt; $ Maximum.values         &lt;dbl&gt; 2.642350e+01, 8.867781e-01, NA, NA, NA, NA, 3.7…</span>
<span class="co">#&gt; $ `1971`                 &lt;dbl&gt; 1.953040e+01, 8.867781e-01, NA, NA, NA, NA, 2.4…</span>
<span class="co">#&gt; $ `2000`                 &lt;dbl&gt; 26.4235000, 0.8747534, NA, NA, NA, NA, 3.783300…</span></code></pre></div>
<p>To obtain a nicely-formatted Excel spreadsheet, use the <code><a href="../reference/write_fu_allocation_template.html">write_fu_allocation_template()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># FU_allocation_template %&gt;%</span>
<span class="co">#   write_fu_allocation_template("~/Desktop/Test_FU_allocation_template.xlsx")</span></code></pre></div>
<p>The analyst should complete all of the unshaded cells in the <code>Machine</code> and <code>Eu.product</code> columns. <code>Machine</code> should contain names of final-to-useful machines such as “Automobiles,” “Industrial heat/furnace,” etc. <code>Eu.product</code> should be filled with names of useful energy carriers such as “HTH.600.C”, “MD”, or “Light”. Note that later processing will parse the heat categories for their temperature, and the required format is <code>*TH.nnn.U</code>, where</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code> (the first character) is arbitrary, but <code>H</code>, <code>M</code>, and <code>L</code> are typical for high, medium, and low temperature heat, respectively,</li>
<li>
<code>TH.</code> is required,</li>
<li>
<code>nnn</code> can be any number of digits, optionally preceded by a negative sign,</li>
<li>
<code>.</code> is required, and</li>
<li>
<code>U</code> is the temperature unit, one of <code>C</code>, <code>F</code>, <code>R</code>, or <code>K</code> for degrees Celsius, degrees Fahrenheit, rankine, or kelvin, respectively.</li>
</ul>
<p>The <code>C</code> rows representation allocations of <code>E.dot</code> energy to final-to-useful machines for each year of available IEA data. Three allocation rows (<code>C_1 [%]</code>, <code>C_2 [%]</code>, and <code>C_3 [%]</code>) are provided for each combination of <code>Flow.aggregation.point</code>, <code>Ef.product</code>, and <code>Destination</code>. Not all <code>C_i [%]</code> rows need to be filled, and the analyst can add more allocation rows (<code>C_4 [%]</code>, <code>C_5 [%]</code>, …) as required.</p>
<p>The rows are in IEA order for <code>Flow.aggregation.point</code>, <code>Ef.product</code>, and <code>Destination</code>.</p>
<p>The <code>Maximum.values</code> column provides an indication of which <code>Destination</code>s receive more energy than others, allowing the analyst to focus more attention on larger energy flows, as desired.</p>
</div>
<div id="final-to-useful-efficiencies-and-useful-exergy-to-energy-ratios" class="section level2">
<h2 class="hasAnchor">
<a href="#final-to-useful-efficiencies-and-useful-exergy-to-energy-ratios" class="anchor"></a>Final-to-useful efficiencies and useful exergy-to-energy ratios</h2>
<p>After completing the final-to-useful allocation table, the analyst must specify the efficiencies of the final-to-useful machines. To assist with this task, the <code><a href="../reference/eta_fu_template.html">eta_fu_template()</a></code> function can be invoked. To demonstrate, we’ll use <code><a href="../reference/load_fu_allocation_data.html">load_fu_allocation_data()</a></code>, a function that reads a completed allocation table out of an excel file. The default <code>path</code> argument of <code><a href="../reference/load_fu_allocation_data.html">load_fu_allocation_data()</a></code> points to a completed final-to-useful allocation table that is provided with <code>IEATools</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Eta_fu_template</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_fu_allocation_data.html">load_fu_allocation_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/eta_fu_template.html">eta_fu_template</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("Country", "Method", "Energy.type", "Last.stage", "Ledger.side", "Flow.aggregation.point", "Unit", "Ef.product", "Destination", "Year")</span>
<span class="va">Eta_fu_template</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Rows: 304</span>
<span class="co">#&gt; Columns: 11</span>
<span class="co">#&gt; $ Country        &lt;chr&gt; "GHA", "GHA", "GHA", "GHA", "GHA", "GHA", "GHA", "GHA",…</span>
<span class="co">#&gt; $ Method         &lt;chr&gt; "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM",…</span>
<span class="co">#&gt; $ Energy.type    &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", "E", …</span>
<span class="co">#&gt; $ Last.stage     &lt;chr&gt; "Final", "Final", "Final", "Final", "Final", "Final", "…</span>
<span class="co">#&gt; $ Unit           &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "ktoe",…</span>
<span class="co">#&gt; $ Machine        &lt;chr&gt; "Automobiles", "Automobiles", "Automobiles", "Automobil…</span>
<span class="co">#&gt; $ Eu.product     &lt;chr&gt; "MD", "MD", "MD", "MD", "MD", "MD", "MD", "MD", "MD", "…</span>
<span class="co">#&gt; $ Quantity       &lt;chr&gt; "E.dot_machine", "E.dot_machine [%]", "eta.fu", "phi.u"…</span>
<span class="co">#&gt; $ Maximum.values &lt;dbl&gt; 6.192510e+02, 1.141842e-01, NA, NA, 1.877078e+02, 3.461…</span>
<span class="co">#&gt; $ `1971`         &lt;dbl&gt; 2.172315e+02, 8.333158e-02, NA, 1.000000e+00, 5.946665e…</span>
<span class="co">#&gt; $ `2000`         &lt;dbl&gt; 6.192510e+02, 1.141842e-01, NA, 1.000000e+00, 1.877078e…</span></code></pre></div>
<p>To obtain a nicely-formatted Excel spreadsheet, use the <code><a href="../reference/write_fu_allocation_template.html">write_fu_allocation_template()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Eta_fu_template %&gt;%</span>
<span class="co">#   write_eta_fu_template("~/Desktop/Test_eta_fu_template.xlsx")</span></code></pre></div>
<p>The analyst should fill all unshaded cells in <code>eta.fu</code> rows with final-to-useful energy efficiency values (in %). <code>phi.u</code> rows should be completed with exergy-to-energy ratios for the useful stage energy carrier. Note that many <code>phi.u</code> values are already filled for cases where the phi value is known or easily calculable, specifically mechanical drive (phi = 1) and heat (phi = 1 - T_0/T_H, where T_H is the heat temperature embedded in the <code>*TH.nnn.U</code> useful exergy string).</p>
<p>The <code>Maximum.values</code> column provides an indication of which <code>Destination</code>s receive more energy than others, allowing the analyst to focus more attention on larger energy flows, as desired. The <code>E.dot_machine</code> and <code>E.dot_machine [%]</code> rows indicate energy flows and percentages into each final-to-useful machine in each year.</p>
<p>After allocations and efficiencies are specified (by completing the templates), functions can be used to move the last stage of an energy conversion chain from final energy to useful energy.</p>
</div>
<div id="allocation-c-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#allocation-c-matrices" class="anchor"></a>Allocation (C) matrices</h2>
<p>Next, the <code>C</code> values from the allocation table must be arranged into <span class="math inline">\(\mathbf{C}\)</span> matrices using the <code><a href="../reference/form_C_mats.html">form_C_mats()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">C_mats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_fu_allocation_data.html">load_fu_allocation_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/form_C_mats.html">form_C_mats</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">C_mats</span><span class="op">)</span>
<span class="co">#&gt; Rows: 4</span>
<span class="co">#&gt; Columns: 7</span>
<span class="co">#&gt; $ Country     &lt;chr&gt; "GHA", "GHA", "ZAF", "ZAF"</span>
<span class="co">#&gt; $ Method      &lt;chr&gt; "PCM", "PCM", "PCM", "PCM"</span>
<span class="co">#&gt; $ Energy.type &lt;chr&gt; "E", "E", "E", "E"</span>
<span class="co">#&gt; $ Last.stage  &lt;chr&gt; "Final", "Final", "Final", "Final"</span>
<span class="co">#&gt; $ Year        &lt;dbl&gt; 1971, 2000, 1971, 2000</span>
<span class="co">#&gt; $ C_EIOU      &lt;list&gt; &lt;&lt;matrix[2 x 3]&gt;&gt;, &lt;&lt;matrix[2 x 3]&gt;&gt;, &lt;&lt;matrix[3 x 3]&gt;&gt;, &lt;…</span>
<span class="co">#&gt; $ C_Y         &lt;list&gt; &lt;&lt;matrix[23 x 21]&gt;&gt;, &lt;&lt;matrix[24 x 22]&gt;&gt;, &lt;&lt;matrix[45 x 31…</span></code></pre></div>
<p>Note that two types of <span class="math inline">\(\mathbf{C}\)</span> matrices are formed, <span class="math inline">\(\mathbf{C}_{EIOU}\)</span> and <span class="math inline">\(\mathbf{C}_Y\)</span>. Both are needed later.</p>
</div>
<div id="efficiency-and-exergy-to-energy-ratio-vectors" class="section level2">
<h2 class="hasAnchor">
<a href="#efficiency-and-exergy-to-energy-ratio-vectors" class="anchor"></a>Efficiency and exergy-to-energy ratio vectors</h2>
<p>Next, vectors containing final-to-useful energy efficiencies (<span class="math inline">\(\mathbf{\eta}_{fu}\)</span>) and exergy-to-energy ratios (<span class="math inline">\(\mathbf{\phi}\)</span>) must be formed using the <code><a href="../reference/form_eta_fu_phi_u_vecs.html">form_eta_fu_phi_u_vecs()</a></code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eta_fu_vecs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_eta_fu_data.html">load_eta_fu_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/form_eta_fu_phi_u_vecs.html">form_eta_fu_phi_u_vecs</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">eta_fu_vecs</span><span class="op">)</span>
<span class="co">#&gt; Rows: 4</span>
<span class="co">#&gt; Columns: 7</span>
<span class="co">#&gt; $ Country     &lt;chr&gt; "GHA", "GHA", "ZAF", "ZAF"</span>
<span class="co">#&gt; $ Method      &lt;chr&gt; "PCM", "PCM", "PCM", "PCM"</span>
<span class="co">#&gt; $ Energy.type &lt;chr&gt; "E", "E", "E", "E"</span>
<span class="co">#&gt; $ Last.stage  &lt;chr&gt; "Final", "Final", "Final", "Final"</span>
<span class="co">#&gt; $ Year        &lt;dbl&gt; 1971, 2000, 1971, 2000</span>
<span class="co">#&gt; $ eta.fu      &lt;list&gt; &lt;&lt;matrix[22 x 1]&gt;&gt;, &lt;&lt;matrix[23 x 1]&gt;&gt;, &lt;&lt;matrix[32 x 1]&gt;&gt;…</span>
<span class="co">#&gt; $ phi.u       &lt;list&gt; &lt;&lt;matrix[22 x 1]&gt;&gt;, &lt;&lt;matrix[23 x 1]&gt;&gt;, &lt;&lt;matrix[32 x 1]&gt;&gt;…</span></code></pre></div>
</div>
<div id="extend-to-useful" class="section level2">
<h2 class="hasAnchor">
<a href="#extend-to-useful" class="anchor"></a>Extend to useful</h2>
<p>To extend an energy conversion chain (ECC) to the useful stage, first convert the IEA data into physical supply-use table format with final energy being the last stage of the energy conversion chain. Thereafter, join the <span class="math inline">\(\mathbf{C}\)</span> matrices and <span class="math inline">\(\mathbf{\eta_{fu}}\)</span> vectors to the data frame of PSUT matrices.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get a list of the metadata columns.</span>
<span class="co"># This list will be the same for C_mats.</span>
<span class="va">m_cols</span> <span class="op">&lt;-</span> <span class="va">eta_fu_vecs</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/meta_cols.html">meta_cols</a></span><span class="op">(</span>return_names <span class="op">=</span> <span class="cn">TRUE</span>,
            years_to_keep <span class="op">=</span> <span class="fu">IEATools</span><span class="fu">::</span><span class="va"><a href="../reference/iea_cols.html">iea_cols</a></span><span class="op">$</span><span class="va">year</span>,
            not_meta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">IEATools</span><span class="fu">::</span><span class="va"><a href="../reference/template_cols.html">template_cols</a></span><span class="op">$</span><span class="va">eta_fu</span>, <span class="fu">IEATools</span><span class="fu">::</span><span class="va"><a href="../reference/template_cols.html">template_cols</a></span><span class="op">$</span><span class="va">phi_u</span><span class="op">)</span><span class="op">)</span>
<span class="va">m_cols</span>
<span class="co">#&gt; [1] "Country"     "Method"      "Energy.type" "Last.stage"  "Year"</span>
<span class="va">psut_mats_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/specify_all.html">specify_all</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/prep_psut.html">prep_psut</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">C_mats</span>, by <span class="op">=</span> <span class="va">m_cols</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">eta_fu_vecs</span>, by <span class="op">=</span> <span class="va">m_cols</span><span class="op">)</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">psut_mats_final</span><span class="op">)</span>
<span class="co">#&gt; Rows: 4</span>
<span class="co">#&gt; Columns: 17</span>
<span class="co">#&gt; $ Country     &lt;chr&gt; "GHA", "GHA", "ZAF", "ZAF"</span>
<span class="co">#&gt; $ Method      &lt;chr&gt; "PCM", "PCM", "PCM", "PCM"</span>
<span class="co">#&gt; $ Energy.type &lt;chr&gt; "E", "E", "E", "E"</span>
<span class="co">#&gt; $ Last.stage  &lt;chr&gt; "Final", "Final", "Final", "Final"</span>
<span class="co">#&gt; $ Year        &lt;dbl&gt; 1971, 2000, 1971, 2000</span>
<span class="co">#&gt; $ V           &lt;list&gt; &lt;&lt;matrix[12 x 14]&gt;&gt;, &lt;&lt;matrix[16 x 16]&gt;&gt;, &lt;&lt;matrix[14 x 21…</span>
<span class="co">#&gt; $ Y           &lt;list&gt; &lt;&lt;matrix[12 x 21]&gt;&gt;, &lt;&lt;matrix[13 x 20]&gt;&gt;, &lt;&lt;matrix[18 x 26…</span>
<span class="co">#&gt; $ S_units     &lt;list&gt; &lt;&lt;matrix[16 x 1]&gt;&gt;, &lt;&lt;matrix[18 x 1]&gt;&gt;, &lt;&lt;matrix[24 x 1]&gt;&gt;…</span>
<span class="co">#&gt; $ R           &lt;list&gt; &lt;&lt;matrix[2 x 2]&gt;&gt;, &lt;&lt;matrix[2 x 2]&gt;&gt;, &lt;&lt;matrix[3 x 3]&gt;&gt;, &lt;…</span>
<span class="co">#&gt; $ U_feed      &lt;list&gt; &lt;&lt;matrix[6 x 5]&gt;&gt;, &lt;&lt;matrix[5 x 5]&gt;&gt;, &lt;&lt;matrix[9 x 11]&gt;&gt;, …</span>
<span class="co">#&gt; $ U_EIOU      &lt;list&gt; &lt;&lt;matrix[2 x 2]&gt;&gt;, &lt;&lt;matrix[2 x 2]&gt;&gt;, &lt;&lt;matrix[2 x 3]&gt;&gt;, …</span>
<span class="co">#&gt; $ U           &lt;list&gt; &lt;&lt;matrix[8 x 5]&gt;&gt;, &lt;&lt;matrix[7 x 5]&gt;&gt;, &lt;&lt;matrix[11 x 11]&gt;&gt;…</span>
<span class="co">#&gt; $ r_EIOU      &lt;list&gt; &lt;&lt;matrix[8 x 5]&gt;&gt;, &lt;&lt;matrix[7 x 5]&gt;&gt;, &lt;&lt;matrix[11 x 11]&gt;&gt;…</span>
<span class="co">#&gt; $ C_EIOU      &lt;list&gt; &lt;&lt;matrix[2 x 3]&gt;&gt;, &lt;&lt;matrix[2 x 3]&gt;&gt;, &lt;&lt;matrix[3 x 3]&gt;&gt;, …</span>
<span class="co">#&gt; $ C_Y         &lt;list&gt; &lt;&lt;matrix[23 x 21]&gt;&gt;, &lt;&lt;matrix[24 x 22]&gt;&gt;, &lt;&lt;matrix[45 x 3…</span>
<span class="co">#&gt; $ eta.fu      &lt;list&gt; &lt;&lt;matrix[22 x 1]&gt;&gt;, &lt;&lt;matrix[23 x 1]&gt;&gt;, &lt;&lt;matrix[32 x 1]&gt;…</span>
<span class="co">#&gt; $ phi.u       &lt;list&gt; &lt;&lt;matrix[22 x 1]&gt;&gt;, &lt;&lt;matrix[23 x 1]&gt;&gt;, &lt;&lt;matrix[32 x 1]&gt;…</span></code></pre></div>
<p>Then use the allocation and efficiency matrices to extend to the useful stage with the <code><a href="../reference/extend_to_useful.html">extend_to_useful()</a></code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psut_mats_useful</span> <span class="op">&lt;-</span> <span class="va">psut_mats_final</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/extend_to_useful.html">extend_to_useful</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">psut_mats_useful</span><span class="op">)</span>
<span class="co">#&gt; Rows: 8</span>
<span class="co">#&gt; Columns: 13</span>
<span class="co">#&gt; $ Country     &lt;chr&gt; "GHA", "GHA", "ZAF", "ZAF", "GHA", "GHA", "ZAF", "ZAF"</span>
<span class="co">#&gt; $ Method      &lt;chr&gt; "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"</span>
<span class="co">#&gt; $ Energy.type &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E"</span>
<span class="co">#&gt; $ Last.stage  &lt;chr&gt; "Final", "Final", "Final", "Final", "Useful", "Useful", "U…</span>
<span class="co">#&gt; $ Year        &lt;dbl&gt; 1971, 2000, 1971, 2000, 1971, 2000, 1971, 2000</span>
<span class="co">#&gt; $ V           &lt;list&gt; &lt;&lt;matrix[12 x 14]&gt;&gt;, &lt;&lt;matrix[16 x 16]&gt;&gt;, &lt;&lt;matrix[14 x 21…</span>
<span class="co">#&gt; $ Y           &lt;list&gt; &lt;&lt;matrix[12 x 21]&gt;&gt;, &lt;&lt;matrix[13 x 20]&gt;&gt;, &lt;&lt;matrix[18 x 26…</span>
<span class="co">#&gt; $ S_units     &lt;list&gt; &lt;&lt;matrix[16 x 1]&gt;&gt;, &lt;&lt;matrix[18 x 1]&gt;&gt;, &lt;&lt;matrix[24 x 1]&gt;&gt;…</span>
<span class="co">#&gt; $ R           &lt;list&gt; &lt;&lt;matrix[2 x 2]&gt;&gt;, &lt;&lt;matrix[2 x 2]&gt;&gt;, &lt;&lt;matrix[3 x 3]&gt;&gt;, &lt;…</span>
<span class="co">#&gt; $ U_feed      &lt;list&gt; &lt;&lt;matrix[6 x 5]&gt;&gt;, &lt;&lt;matrix[5 x 5]&gt;&gt;, &lt;&lt;matrix[9 x 11]&gt;&gt;,…</span>
<span class="co">#&gt; $ U_EIOU      &lt;list&gt; &lt;&lt;matrix[2 x 2]&gt;&gt;, &lt;&lt;matrix[2 x 2]&gt;&gt;, &lt;&lt;matrix[2 x 3]&gt;&gt;, …</span>
<span class="co">#&gt; $ U           &lt;list&gt; &lt;&lt;matrix[8 x 5]&gt;&gt;, &lt;&lt;matrix[7 x 5]&gt;&gt;, &lt;&lt;matrix[11 x 11]&gt;&gt;…</span>
<span class="co">#&gt; $ r_EIOU      &lt;list&gt; &lt;&lt;matrix[8 x 5]&gt;&gt;, &lt;&lt;matrix[7 x 5]&gt;&gt;, &lt;&lt;matrix[11 x 11]&gt;&gt;…</span></code></pre></div>
<p>Notice that several additional rows have been created in the data frame. The additional rows contain versions of ECC matrices wherein the last stage of the ECC is useful energy. Extending to the useful stage means many additional energy products are included in the energy conversion chain. For example, the <span class="math inline">\(\mathbf{Y}\)</span> matrix includes additional rows for mechanical drive (MD), heat (MTH.100.C, e.g.), and light.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A Y matrix where final energy is the last stage of the energy conversion chain</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">psut_mats_useful</span><span class="op">$</span><span class="va">Y</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Aviation gasoline"                    </span>
<span class="co">#&gt;  [2] "Charcoal"                             </span>
<span class="co">#&gt;  [3] "Crude oil"                            </span>
<span class="co">#&gt;  [4] "Electricity"                          </span>
<span class="co">#&gt;  [5] "Fuel oil"                             </span>
<span class="co">#&gt;  [6] "Gas/diesel oil excl. biofuels"        </span>
<span class="co">#&gt;  [7] "Kerosene type jet fuel excl. biofuels"</span>
<span class="co">#&gt;  [8] "Liquefied petroleum gases (LPG)"      </span>
<span class="co">#&gt;  [9] "Lubricants"                           </span>
<span class="co">#&gt; [10] "Motor gasoline excl. biofuels"        </span>
<span class="co">#&gt; [11] "Other kerosene"                       </span>
<span class="co">#&gt; [12] "Primary solid biofuels"</span>

<span class="co"># A Y matrix where useful energy is the last stage of the energy conversion chain</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">psut_mats_useful</span><span class="op">$</span><span class="va">Y</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Aviation gasoline"                    </span>
<span class="co">#&gt;  [2] "Charcoal"                             </span>
<span class="co">#&gt;  [3] "Crude oil"                            </span>
<span class="co">#&gt;  [4] "Electricity"                          </span>
<span class="co">#&gt;  [5] "Fuel oil"                             </span>
<span class="co">#&gt;  [6] "Gas/diesel oil excl. biofuels"        </span>
<span class="co">#&gt;  [7] "HTH.600.C [from Electric heaters]"    </span>
<span class="co">#&gt;  [8] "Kerosene type jet fuel excl. biofuels"</span>
<span class="co">#&gt;  [9] "Light [from Electric lights]"         </span>
<span class="co">#&gt; [10] "Liquefied petroleum gases (LPG)"      </span>
<span class="co">#&gt; [11] "Lubricants"                           </span>
<span class="co">#&gt; [12] "Lubricants [from Non-energy]"         </span>
<span class="co">#&gt; [13] "MD [from Automobiles]"                </span>
<span class="co">#&gt; [14] "MD [from Boat engines]"               </span>
<span class="co">#&gt; [15] "MD [from Diesel cars]"                </span>
<span class="co">#&gt; [16] "MD [from Diesel trains]"              </span>
<span class="co">#&gt; [17] "MD [from Diesel trucks]"              </span>
<span class="co">#&gt; [18] "MD [from Electric motors]"            </span>
<span class="co">#&gt; [19] "MD [from Fans]"                       </span>
<span class="co">#&gt; [20] "MD [from Trucks]"                     </span>
<span class="co">#&gt; [21] "Motor gasoline excl. biofuels"        </span>
<span class="co">#&gt; [22] "MTH.100.C [from Charcoal stoves]"     </span>
<span class="co">#&gt; [23] "MTH.100.C [from Electric stoves]"     </span>
<span class="co">#&gt; [24] "MTH.100.C [from Kerosene stoves]"     </span>
<span class="co">#&gt; [25] "MTH.100.C [from LPG stoves]"          </span>
<span class="co">#&gt; [26] "MTH.100.C [from Wood cookstoves]"     </span>
<span class="co">#&gt; [27] "MTH.200.C [from Electric heaters]"    </span>
<span class="co">#&gt; [28] "MTH.200.C [from Electric stoves]"     </span>
<span class="co">#&gt; [29] "MTH.200.C [from Industrial furnaces]" </span>
<span class="co">#&gt; [30] "MTH.200.C [from Irons]"               </span>
<span class="co">#&gt; [31] "MTH.200.C [from Wood stoves]"         </span>
<span class="co">#&gt; [32] "Other kerosene"                       </span>
<span class="co">#&gt; [33] "Primary solid biofuels"</span></code></pre></div>
<!-- It would be nice to calculate the energy balance of all rows of the data frame here,
     showing that extending to the useful stage does not affect the energy balance of the ECC
     when done correctly.  
     Unfortunately, the function to perform those energy balances resides in the Recca package. 
     By design, IEATools cannot depend on Recca. -->
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>The process of moving from final energy to useful energy as the last stage of an energy conversion chain is aided by several functions in the <code>IEATools</code> package. In particular,</p>
<ul>
<li>
<code><a href="../reference/prep_psut.html">prep_psut()</a></code>,</li>
<li>
<code><a href="../reference/form_C_mats.html">form_C_mats()</a></code>,</li>
<li>
<code><a href="../reference/form_eta_fu_phi_u_vecs.html">form_eta_fu_phi_u_vecs()</a></code>, and</li>
<li><code><a href="../reference/extend_to_useful.html">extend_to_useful()</a></code></li>
</ul>
<p>provide a convenient workflow for that process.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matthew Heun, Emmanuel Aramendia, Zeke Marshall.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
