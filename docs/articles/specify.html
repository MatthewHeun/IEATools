<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Specify EIOU Industries and Flows • IEATools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Specify EIOU Industries and Flows">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IEATools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.14</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/IEATools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/final_to_useful.html">Final to Useful Analysis</a>
    </li>
    <li>
      <a href="../articles/prep_psut.html">Prepare for PSUT analysis</a>
    </li>
    <li>
      <a href="../articles/specify.html">Specify EIOU Industries and Flows</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Specify EIOU Industries and Flows</h1>
                        <h4 class="author">Matthew Kuperus Heun</h4>
            
            <h4 class="date">2020-03-15</h4>
      
      
      <div class="hidden name"><code>specify.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The IEA extended energy balance data include some <code>Flow</code>s that are <code>Energy industry own use</code> (EIOU), the consumption of energy by energy-producing industries. This vignette demonstrates how to deal with the EIOU flows, especially if an analyst is moving toward performing Physical Supply-Use Table (PSUT) analyses with the IEA data. In particular, this vignette will identify some of the problems with using such flows (as they are present in data from the IEA) and how to use functions in the <code>IEATools</code> package to prepare for PSUT analysis.</p>
<p>We’ll use data supplied with this package and accessed by the <code><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df()</a></code> function to illustrate.</p>
<div id="the-iea-approach-to-energy-industry-own-use-eiou-flows" class="section level3">
<h3 class="hasAnchor">
<a href="#the-iea-approach-to-energy-industry-own-use-eiou-flows" class="anchor"></a>The IEA approach to Energy Industry Own Use (EIOU) flows</h3>
<p>The EIOU flows can be found as shown in the following code. The <code>Flow</code> column indicates the industry to which EIOU of type <code>Product</code> is flowing.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(IEATools)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(magrittr)</span>
<span id="cb1-4"><a href="#cb1-4"></a>EIOU_flows &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Flow.aggregation.point <span class="op">==</span><span class="st"> "Energy industry own use"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>EIOU_flows <span class="op">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Country, Year, Flow, Product)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; # A tibble: 15 x 4</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt;    Country  Year Flow                                        Product      </span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;                                       &lt;chr&gt;        </span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt;  1 GHA      1971 Oil refineries                              Refinery gas </span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt;  2 GHA      1971 Own use in electricity, CHP and heat plants Electricity  </span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt;  3 ZAF      1971 Coal mines                                  Electricity  </span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt;  4 ZAF      1971 Oil refineries                              Fuel oil     </span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt;  5 ZAF      1971 Own use in electricity, CHP and heat plants Electricity  </span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">#&gt;  6 GHA      2000 Oil refineries                              Refinery gas </span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">#&gt;  7 GHA      2000 Own use in electricity, CHP and heat plants Electricity  </span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#&gt;  8 ZAF      2000 Coal mines                                  Electricity  </span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#&gt;  9 ZAF      2000 Oil and gas extraction                      Electricity  </span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co">#&gt; 10 ZAF      2000 Coke ovens                                  Electricity  </span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co">#&gt; 11 ZAF      2000 Oil refineries                              Gas works gas</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">#&gt; 12 ZAF      2000 Oil refineries                              Refinery gas </span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">#&gt; 13 ZAF      2000 Oil refineries                              Electricity  </span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">#&gt; 14 ZAF      2000 Own use in electricity, CHP and heat plants Electricity  </span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">#&gt; 15 ZAF      2000 Pumped storage plants                       Electricity</span></span></code></pre></div>
<p>And <code>EIOU</code>-consuming industries can be found by the following code.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>EIOU_flows<span class="op">$</span>Flow <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#&gt; [1] "Oil refineries"                             </span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; [2] "Own use in electricity, CHP and heat plants"</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt; [3] "Coal mines"                                 </span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; [4] "Oil and gas extraction"                     </span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; [5] "Coke ovens"                                 </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; [6] "Pumped storage plants"</span></span></code></pre></div>
<p>Note that one of the industries that receives EIOU is <code>Coal mines (energy)</code>, but coal is not produced by <code>Coal mines (energy)</code> in the IEA data. (The suffix <code>(energy)</code> indicates EIOU.) Rather, coal (of various types) first appears in rows where the <code>Flow</code> is <code>Production</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Flow.aggregation.point <span class="op">==</span><span class="st"> "Total primary energy supply"</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>         Product <span class="op">%in%</span><span class="st"> </span>coal_and_coal_products) <span class="op">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Country, Flow.aggregation.point, Flow, Product) <span class="op">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>()</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; # A tibble: 8 x 4</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt;   Country Flow.aggregation.point      Flow          Product                 </span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;                       &lt;chr&gt;         &lt;chr&gt;                   </span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; 1 ZAF     Total primary energy supply Production    Hard coal (if no detail)</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; 2 ZAF     Total primary energy supply Exports       Hard coal (if no detail)</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; 3 ZAF     Total primary energy supply Production    Coking coal             </span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; 4 ZAF     Total primary energy supply Production    Other bituminous coal   </span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; 5 ZAF     Total primary energy supply Imports       Coking coal             </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; 6 ZAF     Total primary energy supply Exports       Coking coal             </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; 7 ZAF     Total primary energy supply Exports       Other bituminous coal   </span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; 8 ZAF     Total primary energy supply Stock changes Other bituminous coal</span></span></code></pre></div>
</div>
<div id="problems-with-the-iea-approach-to-eiou" class="section level3">
<h3 class="hasAnchor">
<a href="#problems-with-the-iea-approach-to-eiou" class="anchor"></a>Problems with the IEA approach to EIOU</h3>
<p>There are two problems with the IEA’s approach to energy industry own use (EIOU).</p>
<ul>
<li>Assigning all originating flows to <code>Production</code> (as the IEA does) means that some EIOU is routed to an industry that does not produce anything. In the example above, <code>Electricity</code> is routed to <code>Coal mines (energy)</code>, but coal is produced by <code>Production</code>.</li>
<li>Furthermore, if all primary energy carriers originate at <code>Production</code>, there will be problems with “upstream swims” in an Input-Output analysis: demand for one primary energy carrier will imply proportional demand for all other primary energy carriers.</li>
</ul>
</div>
<div id="solving-the-problems-presented-by-the-ieas-approach-to-eiou" class="section level3">
<h3 class="hasAnchor">
<a href="#solving-the-problems-presented-by-the-ieas-approach-to-eiou" class="anchor"></a>Solving the problems presented by the IEA’s approach to EIOU</h3>
<p>To solve these problems, generic <code>Production</code> <code>Flow</code>s need to be specified. In the example above, <code>coal_and_coal_product</code>s should be produced by <code>Coal mines</code>, not the generic <code>Production</code> industry. The <code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code> function accomplishes this task.</p>
</div>
</div>
<div id="identify-primary-production-specify_primary_production" class="section level2">
<h2 class="hasAnchor">
<a href="#identify-primary-production-specify_primary_production" class="anchor"></a>Identify primary production (<code>specify_primary_production()</code>)</h2>
<p>By default, the <code>specify_primary_produciton()</code> function performs the following actions:</p>
<ul>
<li>Coal and coal products
<ul>
<li>The <code>Production</code> industry for <code>coal_and_coal_products</code> is replaced by <code>Coal mines</code>.</li>
<li>A <code>Resources (Coal)</code> industry is created which becomes the source of all primary <code>coal_and_coal_products</code> in the energy conversion chain.</li>
<li>Flows from <code>Resources (Coal)</code> to <code>Coal mines</code> are added, such that <code>Resources (Coal)</code> makes primary <code>coal_and_coal_products</code> but doesn’t use any energy.</li>
<li>The <code>Coal mines (energy)</code> EIOU <code>Flow</code> is replaced by <code>Coal mines</code>.</li>
</ul>
</li>
<li>Oil and oil products and Natural gas
<ul>
<li>The <code>Production</code> industry for <code>oil_and_oil_products</code> and <code>Natural gas</code> is replaced by <code>Oil and gas extraction</code>.</li>
<li>A <code>Resources (Oil and natural gas)</code> industry is created which becomes the source of all primary <code>oil_and_oil_products</code> and <code>Natural gas</code> in the energy conversion chain.</li>
<li>Flows from <code>Resources (Oil and natural gas)</code> to <code>Oil and gas extraction</code> are added, such that <code>Resources (Oil and natural gas)</code> makes primary <code>Oil_and_oil_products</code> and <code>Natural gas</code> but doesn’t use any energy.</li>
<li>The <code>Oil and gas extraction (energy)</code> EIOU <code>Flow</code> is replaced by <code>Oil and gas extraction</code>.</li>
</ul>
</li>
</ul>
<p>The code below demonstrates <code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code>. Note that the <code>Resources</code> <code>Flow</code>s are tagged as belonging to the Resources matrix (<code>R</code>) by the <code><a href="../reference/add_psut_matnames.html">add_psut_matnames()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>Specific_primary_production &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_primary_production.html">specify_primary_production</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st">  </span><span class="kw"><a href="../reference/add_psut_matnames.html">add_psut_matnames</a></span>()</span>
<span id="cb4-4"><a href="#cb4-4"></a>Specific_primary_production <span class="op">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Flow <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Resources (Coal)"</span>, <span class="st">"Resources (Oil and natural gas)"</span>)) <span class="op">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>Method, <span class="op">-</span>Last.stage, <span class="op">-</span>Energy.type, <span class="op">-</span>Ledger.side, <span class="op">-</span>Unit) <span class="op">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>()</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt;   Country Year      Flow.aggregation.point                            Flow</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; 1     ZAF 1971 Total primary energy supply                Resources (Coal)</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; 2     ZAF 2000 Total primary energy supply                Resources (Coal)</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; 3     ZAF 2000 Total primary energy supply Resources (Oil and natural gas)</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; 4     ZAF 2000 Total primary energy supply Resources (Oil and natural gas)</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; 5     ZAF 2000 Total primary energy supply Resources (Oil and natural gas)</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; 6     ZAF 2000 Total primary energy supply                Resources (Coal)</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt;                    Product       E.dot matnames</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; 1 Hard coal (if no detail)  33064.4311        R</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; 2              Coking coal   2371.9304        R</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; 3                Crude oil    666.8167        R</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; 4              Natural gas   1397.7644        R</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; 5      Natural gas liquids    276.6636        R</span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; 6    Other bituminous coal 124554.3759        R</span></span></code></pre></div>
<p>Furthermore, the added flows from the <code>Resource</code> industries are tagged as <code>Transformation processes</code> and belong in the <code>U_excl_EIOU</code> and <code>V</code> matrices. The EIOU flows are shown to belong in the <code>U_EIOU</code> matrix.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>Specific_primary_production <span class="op">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Flow <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Coal mines"</span>, <span class="st">"Oil and gas extraction"</span>)) <span class="op">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>()</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt;    Country Method Energy.type Last.stage Year Ledger.side</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt; 1      ZAF    PCM           E      Final 1971      Supply</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; 2      ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; 3      ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; 4      ZAF    PCM           E      Final 1971      Supply</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; 5      ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; 6      ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; 7      ZAF    PCM           E      Final 1971      Supply</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; 8      ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt; 9      ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt; 10     ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt; 11     ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">#&gt; 12     ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">#&gt; 13     ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co">#&gt; 14     ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co">#&gt; 15     ZAF    PCM           E      Final 2000      Supply</span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co">#&gt;      Flow.aggregation.point                   Flow</span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co">#&gt; 1   Energy industry own use             Coal mines</span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="co">#&gt; 2   Energy industry own use             Coal mines</span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co">#&gt; 3   Energy industry own use Oil and gas extraction</span></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="co">#&gt; 4  Transformation processes             Coal mines</span></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="co">#&gt; 5  Transformation processes             Coal mines</span></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="co">#&gt; 6  Transformation processes             Coal mines</span></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="co">#&gt; 7  Transformation processes             Coal mines</span></span>
<span id="cb5-28"><a href="#cb5-28"></a><span class="co">#&gt; 8  Transformation processes             Coal mines</span></span>
<span id="cb5-29"><a href="#cb5-29"></a><span class="co">#&gt; 9  Transformation processes             Coal mines</span></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co">#&gt; 10 Transformation processes Oil and gas extraction</span></span>
<span id="cb5-31"><a href="#cb5-31"></a><span class="co">#&gt; 11 Transformation processes Oil and gas extraction</span></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="co">#&gt; 12 Transformation processes Oil and gas extraction</span></span>
<span id="cb5-33"><a href="#cb5-33"></a><span class="co">#&gt; 13 Transformation processes Oil and gas extraction</span></span>
<span id="cb5-34"><a href="#cb5-34"></a><span class="co">#&gt; 14 Transformation processes Oil and gas extraction</span></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co">#&gt; 15 Transformation processes Oil and gas extraction</span></span>
<span id="cb5-36"><a href="#cb5-36"></a><span class="co">#&gt;                                         Product Unit        E.dot    matnames</span></span>
<span id="cb5-37"><a href="#cb5-37"></a><span class="co">#&gt; 1                                   Electricity ktoe     -52.3646      U_EIOU</span></span>
<span id="cb5-38"><a href="#cb5-38"></a><span class="co">#&gt; 2                                   Electricity ktoe    -237.4033      U_EIOU</span></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="co">#&gt; 3                                   Electricity ktoe      -0.0860      U_EIOU</span></span>
<span id="cb5-40"><a href="#cb5-40"></a><span class="co">#&gt; 4                      Hard coal (if no detail) ktoe  -33064.4311 U_excl_EIOU</span></span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="co">#&gt; 5                                   Coking coal ktoe   -2371.9304 U_excl_EIOU</span></span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="co">#&gt; 6                         Other bituminous coal ktoe -124554.3759 U_excl_EIOU</span></span>
<span id="cb5-43"><a href="#cb5-43"></a><span class="co">#&gt; 7         Hard coal (if no detail) (Coal mines) ktoe   33064.4311           V</span></span>
<span id="cb5-44"><a href="#cb5-44"></a><span class="co">#&gt; 8                      Coking coal (Coal mines) ktoe    2371.9304           V</span></span>
<span id="cb5-45"><a href="#cb5-45"></a><span class="co">#&gt; 9            Other bituminous coal (Coal mines) ktoe  124554.3759           V</span></span>
<span id="cb5-46"><a href="#cb5-46"></a><span class="co">#&gt; 10                                    Crude oil ktoe    -666.8167 U_excl_EIOU</span></span>
<span id="cb5-47"><a href="#cb5-47"></a><span class="co">#&gt; 11                                  Natural gas ktoe   -1397.7644 U_excl_EIOU</span></span>
<span id="cb5-48"><a href="#cb5-48"></a><span class="co">#&gt; 12                          Natural gas liquids ktoe    -276.6636 U_excl_EIOU</span></span>
<span id="cb5-49"><a href="#cb5-49"></a><span class="co">#&gt; 13           Crude oil (Oil and gas extraction) ktoe     666.8167           V</span></span>
<span id="cb5-50"><a href="#cb5-50"></a><span class="co">#&gt; 14         Natural gas (Oil and gas extraction) ktoe    1397.7644           V</span></span>
<span id="cb5-51"><a href="#cb5-51"></a><span class="co">#&gt; 15 Natural gas liquids (Oil and gas extraction) ktoe     276.6636           V</span></span>
<span id="cb5-52"><a href="#cb5-52"></a>Specific_primary_production <span class="op">%&gt;%</span></span>
<span id="cb5-53"><a href="#cb5-53"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Flow.aggregation.point <span class="op">==</span><span class="st"> "Energy industry own use"</span> ) <span class="op">%&gt;%</span></span>
<span id="cb5-54"><a href="#cb5-54"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Country, Year, Flow, Product, E.dot, matnames) <span class="op">%&gt;%</span></span>
<span id="cb5-55"><a href="#cb5-55"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>()</span>
<span id="cb5-56"><a href="#cb5-56"></a><span class="co">#&gt;    Country Year                                        Flow       Product</span></span>
<span id="cb5-57"><a href="#cb5-57"></a><span class="co">#&gt; 1      GHA 1971                              Oil refineries  Refinery gas</span></span>
<span id="cb5-58"><a href="#cb5-58"></a><span class="co">#&gt; 2      GHA 1971 Own use in electricity, CHP and heat plants   Electricity</span></span>
<span id="cb5-59"><a href="#cb5-59"></a><span class="co">#&gt; 3      GHA 2000                              Oil refineries  Refinery gas</span></span>
<span id="cb5-60"><a href="#cb5-60"></a><span class="co">#&gt; 4      GHA 2000 Own use in electricity, CHP and heat plants   Electricity</span></span>
<span id="cb5-61"><a href="#cb5-61"></a><span class="co">#&gt; 5      ZAF 1971                                  Coal mines   Electricity</span></span>
<span id="cb5-62"><a href="#cb5-62"></a><span class="co">#&gt; 6      ZAF 1971                              Oil refineries      Fuel oil</span></span>
<span id="cb5-63"><a href="#cb5-63"></a><span class="co">#&gt; 7      ZAF 1971 Own use in electricity, CHP and heat plants   Electricity</span></span>
<span id="cb5-64"><a href="#cb5-64"></a><span class="co">#&gt; 8      ZAF 2000                                  Coal mines   Electricity</span></span>
<span id="cb5-65"><a href="#cb5-65"></a><span class="co">#&gt; 9      ZAF 2000                                  Coke ovens   Electricity</span></span>
<span id="cb5-66"><a href="#cb5-66"></a><span class="co">#&gt; 10     ZAF 2000                      Oil and gas extraction   Electricity</span></span>
<span id="cb5-67"><a href="#cb5-67"></a><span class="co">#&gt; 11     ZAF 2000                              Oil refineries   Electricity</span></span>
<span id="cb5-68"><a href="#cb5-68"></a><span class="co">#&gt; 12     ZAF 2000                              Oil refineries Gas works gas</span></span>
<span id="cb5-69"><a href="#cb5-69"></a><span class="co">#&gt; 13     ZAF 2000                              Oil refineries  Refinery gas</span></span>
<span id="cb5-70"><a href="#cb5-70"></a><span class="co">#&gt; 14     ZAF 2000 Own use in electricity, CHP and heat plants   Electricity</span></span>
<span id="cb5-71"><a href="#cb5-71"></a><span class="co">#&gt; 15     ZAF 2000                       Pumped storage plants   Electricity</span></span>
<span id="cb5-72"><a href="#cb5-72"></a><span class="co">#&gt;         E.dot matnames</span></span>
<span id="cb5-73"><a href="#cb5-73"></a><span class="co">#&gt; 1    -19.5304   U_EIOU</span></span>
<span id="cb5-74"><a href="#cb5-74"></a><span class="co">#&gt; 2     -2.4936   U_EIOU</span></span>
<span id="cb5-75"><a href="#cb5-75"></a><span class="co">#&gt; 3    -26.4235   U_EIOU</span></span>
<span id="cb5-76"><a href="#cb5-76"></a><span class="co">#&gt; 4     -3.7833   U_EIOU</span></span>
<span id="cb5-77"><a href="#cb5-77"></a><span class="co">#&gt; 5    -52.3646   U_EIOU</span></span>
<span id="cb5-78"><a href="#cb5-78"></a><span class="co">#&gt; 6   -579.9369   U_EIOU</span></span>
<span id="cb5-79"><a href="#cb5-79"></a><span class="co">#&gt; 7   -305.4170   U_EIOU</span></span>
<span id="cb5-80"><a href="#cb5-80"></a><span class="co">#&gt; 8   -237.4033   U_EIOU</span></span>
<span id="cb5-81"><a href="#cb5-81"></a><span class="co">#&gt; 9     -0.0860   U_EIOU</span></span>
<span id="cb5-82"><a href="#cb5-82"></a><span class="co">#&gt; 10    -0.0860   U_EIOU</span></span>
<span id="cb5-83"><a href="#cb5-83"></a><span class="co">#&gt; 11 -1146.2597   U_EIOU</span></span>
<span id="cb5-84"><a href="#cb5-84"></a><span class="co">#&gt; 12    -0.5804   U_EIOU</span></span>
<span id="cb5-85"><a href="#cb5-85"></a><span class="co">#&gt; 13 -1052.3455   U_EIOU</span></span>
<span id="cb5-86"><a href="#cb5-86"></a><span class="co">#&gt; 14 -1052.5365   U_EIOU</span></span>
<span id="cb5-87"><a href="#cb5-87"></a><span class="co">#&gt; 15   -55.4600   U_EIOU</span></span></code></pre></div>
</div>
<div id="convert-production-to-resources-specify_production_to_resources" class="section level2">
<h2 class="hasAnchor">
<a href="#convert-production-to-resources-specify_production_to_resources" class="anchor"></a>Convert <code>Production</code> to <code>Resources</code> (<code>specify_production_to_resources()</code>)</h2>
<p>The IEA extended energy balances give resource extraction in rows where the <code>Flow</code> is “<code>Production</code>”. <code><a href="../reference/specify_production_to_resources.html">specify_production_to_resources()</a></code> changes the “<code>Production</code>” string to “<code>Resources (product)</code>”, where <code>product</code> is the name of the energy carrier for this resource. <code><a href="../reference/specify_production_to_resources.html">specify_production_to_resources()</a></code> should be called <em>after</em> <code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code>, which adjusts for energy industry own use of some primary energy producing industries. If this function is called first, energy industry own use will not be accounted correctly.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_primary_production.html">specify_primary_production</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_production_to_resources.html">specify_production_to_resources</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/startsWith.html">startsWith</a></span>(Flow, <span class="st">"Resources"</span>)) <span class="op">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; Observations: 15</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; Variables: 11</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; $ Country                &lt;chr&gt; "GHA", "GHA", "GHA", "GHA", "ZAF", "ZAF", "ZAF…</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; $ Method                 &lt;chr&gt; "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM…</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; $ Energy.type            &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E", "E", "…</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; $ Last.stage             &lt;chr&gt; "Final", "Final", "Final", "Final", "Final", "…</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; $ Year                   &lt;dbl&gt; 1971, 1971, 2000, 2000, 1971, 1971, 1971, 2000…</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; $ Ledger.side            &lt;chr&gt; "Supply", "Supply", "Supply", "Supply", "Suppl…</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; $ Flow.aggregation.point &lt;chr&gt; "Total primary energy supply", "Total primary …</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; $ Flow                   &lt;chr&gt; "Resources (Hydro)", "Resources (Primary solid…</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; $ Product                &lt;chr&gt; "Hydro", "Primary solid biofuels", "Hydro", "P…</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt; $ Unit                   &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "ktoe"…</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt; $ E.dot                  &lt;dbl&gt; 250.1290, 2087.5131, 568.2717, 3891.0146, 3306…</span></span></code></pre></div>
</div>
<div id="be-more-specific-about-interface-industries-specify_interface_industries" class="section level2">
<h2 class="hasAnchor">
<a href="#be-more-specific-about-interface-industries-specify_interface_industries" class="anchor"></a>Be more specific about interface industries (<code>specify_interface_industries()</code>)</h2>
<p>An interface industry is one that moves energy carriers into or out of a country. When <code>Flow</code> is any of the interface industries, we need to be more specific. If we don’t separate these <code>Flow</code>s by <code>Product</code>, we run into trouble in the PSUT framework:</p>
<ul>
<li>upstream swims will result in all <code>Product</code>s being produced even if only one is needed and</li>
<li>embodied energy calculations will result in many types of energy being embodied, even if only one should be.</li>
</ul>
<p>To solve these problems, <code><a href="../reference/specify_interface_industries.html">specify_interface_industries()</a></code> adds a suffix <code>(Product)</code> to each of these interface industries.</p>
<p>Note that “<code>Production</code>” <code>Flow</code>s also needs to be specified, but that is accomplished in the <code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code> and <code><a href="../reference/specify_production_to_resources.html">specify_production_to_resources()</a></code> functions.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_interface_industries.html">specify_interface_industries</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="../reference/starts_with_any_of.html">starts_with_any_of</a></span>(Flow, IEATools<span class="op">::</span>interface_industries)) <span class="op">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; Observations: 68</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; Variables: 11</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; $ Country                &lt;chr&gt; "GHA", "GHA", "GHA", "GHA", "GHA", "GHA", "GHA…</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; $ Method                 &lt;chr&gt; "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM…</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; $ Energy.type            &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E", "E", "…</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; $ Last.stage             &lt;chr&gt; "Final", "Final", "Final", "Final", "Final", "…</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; $ Year                   &lt;dbl&gt; 1971, 1971, 1971, 1971, 1971, 1971, 1971, 1971…</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt; $ Ledger.side            &lt;chr&gt; "Supply", "Supply", "Supply", "Supply", "Suppl…</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt; $ Flow.aggregation.point &lt;chr&gt; "Total primary energy supply", "Total primary …</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt; $ Flow                   &lt;chr&gt; "Imports (Crude oil)", "Imports (Aviation gaso…</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt; $ Product                &lt;chr&gt; "Crude oil", "Aviation gasoline", "Kerosene ty…</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt; $ Unit                   &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "ktoe"…</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt; $ E.dot                  &lt;dbl&gt; 916.2081, 1.0700, 21.3051, 1.0461, 18.0567, -4…</span></span></code></pre></div>
</div>
<div id="be-more-specific-about-transformation-process-energy-industry-own-use-specify_tp_eiou" class="section level2">
<h2 class="hasAnchor">
<a href="#be-more-specific-about-transformation-process-energy-industry-own-use-specify_tp_eiou" class="anchor"></a>Be more specific about Transformation process Energy industry own use (<code>specify_tp_eiou()</code>)</h2>
<p>The extended energy balance data from the IEA includes “Energy industry own use” (EIOU) for many transformation processes. Unfortunately, in some cases the EIOU flows into industries that aren’t included in transformation processes. For example, <code>Electricity</code> is consumed by <code>Own use in electricity, CHP and heat plants</code>, which is not a transformation process. We have to make some decisions to ensure that EIOU is routed to actual transformation processes. Changes made to the <code>.tidy_iea_df</code> data frame are:</p>
<ol style="list-style-type: decimal">
<li>EIOU classified as <code>own_use_elect_chp_heat</code> (by default “Own use in electricity, CHP and heat plants”) is sent to <code>main_act_producer_elect</code> (by default “Main activity producer electricity plants”).</li>
<li>EIOU classified as <code>pumped_storage</code> (by default “Pumped storage plants”") is sent to <code>main_act_producer_elect</code>.</li>
<li>EIOU classified as <code>nuclear_industry</code> (by default “Nuclear industry”) is sent to <code>main_act_producer_elect</code>.</li>
<li>EIOU classified as <code>non_spec_energy</code> (by default “Non-specified (energy)”) is sent to <code>nonspecenergy_reclassify</code> (by default “Non-specified (transformation)”).</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_tp_eiou.html">specify_tp_eiou</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Flow.aggregation.point <span class="op">==</span><span class="st"> "Energy industry own use"</span> <span class="op">&amp;</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">           </span>Flow <span class="op">==</span><span class="st"> "Main activity producer electricity plants"</span>) <span class="op">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; Observations: 4</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; Variables: 11</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; $ Country                &lt;chr&gt; "GHA", "GHA", "ZAF", "ZAF"</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt; $ Method                 &lt;chr&gt; "PCM", "PCM", "PCM", "PCM"</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt; $ Energy.type            &lt;chr&gt; "E", "E", "E", "E"</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; $ Last.stage             &lt;chr&gt; "Final", "Final", "Final", "Final"</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; $ Year                   &lt;dbl&gt; 1971, 2000, 1971, 2000</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt; $ Ledger.side            &lt;chr&gt; "Supply", "Supply", "Supply", "Supply"</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt; $ Flow.aggregation.point &lt;chr&gt; "Energy industry own use", "Energy industry ow…</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt; $ Flow                   &lt;chr&gt; "Main activity producer electricity plants", "…</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt; $ Product                &lt;chr&gt; "Electricity", "Electricity", "Electricity", "…</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt; $ Unit                   &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe"</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">#&gt; $ E.dot                  &lt;dbl&gt; -2.4936, -3.7833, -305.4170, -1107.9965</span></span></code></pre></div>
</div>
<div id="identify-transformation-process-sinks-and-sources-tp_sinks_sources" class="section level2">
<h2 class="hasAnchor">
<a href="#identify-transformation-process-sinks-and-sources-tp_sinks_sources" class="anchor"></a>Identify Transformation process sinks and sources (<code>tp_sinks_sources()</code>)</h2>
<p>In the IEA extended energy balance data, transformation processes (tp) ought to both consume and produce energy. But some transformation processes consume energy without producing any energy; others produce without consuming. Such transformation processes can be called “transformation sinks” and “transformation sources,” respectively. This function finds and identifies transformation processes that act as sinks or sources.</p>
<p>It is important to identify transformation sinks, because they cause two problems for physical supply-use table (PSUT) analysis. First, when swimming upstream, a PSUT analysis cannot “see” the sunk energy carriers, because they have no downstream effects. Thus, upstream swims cannot conserve energy. Second, when calculating embodied energy for each downstream energy carrier, the sunk energy carriers cannot be embodied in any final demand energy carriers. Thus, embodied energy calculations cannot conserve energy.</p>
<p>Transformation sources can also cause problems for physical supply-use table (PSUT) analysis. In particular, when swimming upstream, a PSUT analysis will “see” the final energy sources, but cannot see any associated primary energy carriers.</p>
<p>Transformation sinks and sources are identified by the following algorithm:</p>
<ol style="list-style-type: decimal">
<li>Identify (per group in <code>.tidy_iea_df</code>) all <code>Transformation processes</code> that consume energy (negative value for <code>E.dot</code>). Energy consumption can be for the transformation process itself or for Energy industry own use.</li>
<li>Identify (per group in <code>.tidy_iea_df</code>) all <code>Transformation processes</code> that produce energy (positive value for <code>E.dot</code>).</li>
<li>Take the set difference between the two (consumers less producers for sinks and producers less consumers for sources). The set difference is the list of transformation sinks or sources, respectively.</li>
</ol>
<p><code><a href="../reference/tp_sinks_sources.html">tp_sinks_sources()</a></code> is a function not unlike <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">dplyr::summarise()</a></code>; it returns a summary containing grouping variables and industries that are transformation sinks or sources. The various <code>specify_*()</code> functions should also be called <em>before</em> calling [tp_sinks_sources()]. The <code>specify_*()</code> functions clean up the IEA data, ensuring that energy is routed to the right places.</p>
<p>Note that this function only identifies transformation sinks or sources; it does not fix the problem. To solve the problem of transformation sinks, see the [tp_sinks_to_nonenergy()] function. <code><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy()</a></code> uses the output of <code><a href="../reference/tp_sinks_sources.html">tp_sinks_sources()</a></code> to route energy consumed by transformation sinks to <code>Non-energy use industry/transformation/energy</code>. There is no function to solve the problem of transformation sources at this time.</p>
<p><code><a href="../reference/tp_sinks_sources.html">tp_sinks_sources()</a></code> returns metadata columns and the <code>Flow</code> column. The <code>Flow</code> column contains industries that are sinks or sources, depending on the value of the <code>type</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># The included data sets to not have any transformation process sinks or sources.</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># Demonstrate with a made-up data set.</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">Flow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Automobiles"</span>, <span class="st">"Automobiles"</span>, <span class="st">"Furnaces"</span>),</span>
<span id="cb9-4"><a href="#cb9-4"></a>                   <span class="dt">E.dot =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb9-5"><a href="#cb9-5"></a>                   <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="dt">Country =</span> <span class="st">"A country"</span>,</span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="dt">Flow.aggregation.point =</span> <span class="st">"Transformation processes"</span>,</span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="dt">Product =</span> <span class="st">"A product"</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="st">  </span><span class="co"># Automobiles both consume and produce energy,</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="st">  </span><span class="co"># so Automobiles are not reported by tp_sinks_sources.</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="st">  </span><span class="co"># However, Furnaces make Product without consuming any energy,</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="st">  </span><span class="co"># and are, therefore, a transformation source.</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="st">  </span><span class="kw"><a href="../reference/tp_sinks_sources.html">tp_sinks_sources</a></span>(<span class="dt">type =</span> <span class="st">"sources"</span>)</span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">#&gt;   Country   Flow    </span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;   </span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">#&gt; 1 A country Furnaces</span></span></code></pre></div>
</div>
<div id="convert-transformation-process-sinks-to-non-energy-flows-tp_sinks_to_nonenergy" class="section level2">
<h2 class="hasAnchor">
<a href="#convert-transformation-process-sinks-to-non-energy-flows-tp_sinks_to_nonenergy" class="anchor"></a>Convert Transformation process sinks to Non-energy flows (<code>tp_sinks_to_nonenergy()</code> )</h2>
<p>This function reclassifies energy flowing into transformation process sinks as <code>non_energy_flow</code>, by default “Non-energy use in industry/transformation/energy”. If there was already some Non-energy use, the new Non-energy use is added to the existing Non-energy use.</p>
<p><code><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy()</a></code> uses the <code><a href="../reference/tp_sinks_sources.html">tp_sinks_sources()</a></code> function internally to identify transformation process sinks.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>DF &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="dt">Ledger.side =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Supply"</span>, <span class="st">"Supply"</span>, <span class="st">"Supply"</span>, <span class="st">"Consumption"</span>),</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="dt">Flow.aggregation.point =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Transformation processes"</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>                             <span class="st">"Transformation processes"</span>,</span>
<span id="cb10-5"><a href="#cb10-5"></a>                             <span class="st">"Transformation processes"</span>,</span>
<span id="cb10-6"><a href="#cb10-6"></a>                             <span class="st">"Non-energy use"</span>),</span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="dt">Flow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Automobiles"</span>, <span class="st">"Automobiles"</span>, <span class="st">"Furnaces"</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>           <span class="st">"Non-energy use industry/transformation/energy"</span>),</span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="dt">Product =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Petrol"</span>, <span class="st">"MD"</span>, <span class="st">"Coal"</span>, <span class="st">"Coal"</span>),</span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="dt">E.dot =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">-2</span>, <span class="dv">8</span>),</span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>) <span class="op">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="dt">Method =</span> <span class="st">"PCM"</span>,</span>
<span id="cb10-15"><a href="#cb10-15"></a>    <span class="dt">Last.stage =</span> <span class="st">"Final"</span>,</span>
<span id="cb10-16"><a href="#cb10-16"></a>    <span class="dt">Energy.type =</span> <span class="st">"E"</span>,</span>
<span id="cb10-17"><a href="#cb10-17"></a>    <span class="dt">Country =</span> <span class="st">"Bogus"</span>,</span>
<span id="cb10-18"><a href="#cb10-18"></a>    <span class="dt">Year =</span> <span class="dv">1971</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>  )</span>
<span id="cb10-20"><a href="#cb10-20"></a>DF</span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="co">#&gt;   Ledger.side   Flow.aggregation.point</span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">#&gt; 1      Supply Transformation processes</span></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">#&gt; 2      Supply Transformation processes</span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co">#&gt; 3      Supply Transformation processes</span></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">#&gt; 4 Consumption           Non-energy use</span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co">#&gt;                                            Flow Product E.dot Method Last.stage</span></span>
<span id="cb10-27"><a href="#cb10-27"></a><span class="co">#&gt; 1                                   Automobiles  Petrol    -1    PCM      Final</span></span>
<span id="cb10-28"><a href="#cb10-28"></a><span class="co">#&gt; 2                                   Automobiles      MD     1    PCM      Final</span></span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="co">#&gt; 3                                      Furnaces    Coal    -2    PCM      Final</span></span>
<span id="cb10-30"><a href="#cb10-30"></a><span class="co">#&gt; 4 Non-energy use industry/transformation/energy    Coal     8    PCM      Final</span></span>
<span id="cb10-31"><a href="#cb10-31"></a><span class="co">#&gt;   Energy.type Country Year</span></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="co">#&gt; 1           E   Bogus 1971</span></span>
<span id="cb10-33"><a href="#cb10-33"></a><span class="co">#&gt; 2           E   Bogus 1971</span></span>
<span id="cb10-34"><a href="#cb10-34"></a><span class="co">#&gt; 3           E   Bogus 1971</span></span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="co">#&gt; 4           E   Bogus 1971</span></span>
<span id="cb10-36"><a href="#cb10-36"></a><span class="co"># In this example, Furnaces are a transformation process sink:</span></span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="co"># they consume Coal but produce nothing.</span></span>
<span id="cb10-38"><a href="#cb10-38"></a><span class="co"># There are already 8 units of Coal consumption for Non-energy uses.</span></span>
<span id="cb10-39"><a href="#cb10-39"></a><span class="co"># The 2 units of Coal are added to the existing 8 units</span></span>
<span id="cb10-40"><a href="#cb10-40"></a><span class="co"># Non-energy consumption to make 10 units of Non-energy consumption.</span></span>
<span id="cb10-41"><a href="#cb10-41"></a>DF <span class="op">%&gt;%</span></span>
<span id="cb10-42"><a href="#cb10-42"></a><span class="st">  </span><span class="kw"><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb10-43"><a href="#cb10-43"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>()</span>
<span id="cb10-44"><a href="#cb10-44"></a><span class="co">#&gt;   Ledger.side   Flow.aggregation.point</span></span>
<span id="cb10-45"><a href="#cb10-45"></a><span class="co">#&gt; 1      Supply Transformation processes</span></span>
<span id="cb10-46"><a href="#cb10-46"></a><span class="co">#&gt; 2      Supply Transformation processes</span></span>
<span id="cb10-47"><a href="#cb10-47"></a><span class="co">#&gt; 3 Consumption           Non-energy use</span></span>
<span id="cb10-48"><a href="#cb10-48"></a><span class="co">#&gt;                                            Flow Product E.dot Method Last.stage</span></span>
<span id="cb10-49"><a href="#cb10-49"></a><span class="co">#&gt; 1                                   Automobiles  Petrol    -1    PCM      Final</span></span>
<span id="cb10-50"><a href="#cb10-50"></a><span class="co">#&gt; 2                                   Automobiles      MD     1    PCM      Final</span></span>
<span id="cb10-51"><a href="#cb10-51"></a><span class="co">#&gt; 3 Non-energy use industry/transformation/energy    Coal    10    PCM      Final</span></span>
<span id="cb10-52"><a href="#cb10-52"></a><span class="co">#&gt;   Energy.type Country Year</span></span>
<span id="cb10-53"><a href="#cb10-53"></a><span class="co">#&gt; 1           E   Bogus 1971</span></span>
<span id="cb10-54"><a href="#cb10-54"></a><span class="co">#&gt; 2           E   Bogus 1971</span></span>
<span id="cb10-55"><a href="#cb10-55"></a><span class="co">#&gt; 3           E   Bogus 1971</span></span></code></pre></div>
</div>
<div id="put-it-all-together-specify_all" class="section level2">
<h2 class="hasAnchor">
<a href="#put-it-all-together-specify_all" class="anchor"></a>Put it all together (<code>specify_all()</code>)</h2>
<p><code><a href="../reference/specify_all.html">specify_all()</a></code> is a convenience function that bundles several others:</p>
<ol style="list-style-type: decimal">
<li><code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code></li>
<li><code><a href="../reference/specify_production_to_resources.html">specify_production_to_resources()</a></code></li>
<li><code><a href="../reference/specify_tp_eiou.html">specify_tp_eiou()</a></code></li>
<li><code><a href="../reference/specify_interface_industries.html">specify_interface_industries()</a></code></li>
<li><code><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy()</a></code></li>
</ol>
<p>Each bundled function is called in turn using default arguments.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>Simple &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_all.html">specify_all</a></span>()</span>
<span id="cb11-3"><a href="#cb11-3"></a>Complicated &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_primary_production.html">specify_primary_production</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_production_to_resources.html">specify_production_to_resources</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_tp_eiou.html">specify_tp_eiou</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">  </span><span class="kw"><a href="../reference/specify_interface_industries.html">specify_interface_industries</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="st">  </span><span class="kw"><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy</a></span>()</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(Simple <span class="op">==</span><span class="st"> </span>Complicated)</span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>This vignette demonstrated how to specify details of primary and transformation process flows. The next step could be to prepare the IEA data for use within the PSUT framework. For details, see the <a href="prep_psut.html">Prep PSUT</a> vignette.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#identify-primary-production-specify_primary_production">Identify primary production (<code>specify_primary_production()</code>)</a></li>
      <li><a href="#convert-production-to-resources-specify_production_to_resources">Convert <code>Production</code> to <code>Resources</code> (<code>specify_production_to_resources()</code>)</a></li>
      <li><a href="#be-more-specific-about-interface-industries-specify_interface_industries">Be more specific about interface industries (<code>specify_interface_industries()</code>)</a></li>
      <li><a href="#be-more-specific-about-transformation-process-energy-industry-own-use-specify_tp_eiou">Be more specific about Transformation process Energy industry own use (<code>specify_tp_eiou()</code>)</a></li>
      <li><a href="#identify-transformation-process-sinks-and-sources-tp_sinks_sources">Identify Transformation process sinks and sources (<code>tp_sinks_sources()</code>)</a></li>
      <li><a href="#convert-transformation-process-sinks-to-non-energy-flows-tp_sinks_to_nonenergy">Convert Transformation process sinks to Non-energy flows (<code>tp_sinks_to_nonenergy()</code> )</a></li>
      <li><a href="#put-it-all-together-specify_all">Put it all together (<code>specify_all()</code>)</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matthew Heun.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
