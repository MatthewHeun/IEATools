<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="IEATools">
<title>Specify EIOU Industries and Flows • IEATools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Specify EIOU Industries and Flows">
<meta property="og:description" content="IEATools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">IEATools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.69</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/IEATools.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/final_to_useful.html">Final to Useful Analysis</a>
    <a class="dropdown-item" href="../articles/fix_iea_data.html">Fixes for IEA Data</a>
    <a class="dropdown-item" href="../articles/prep_psut.html">Prepare for PSUT analysis</a>
    <a class="dropdown-item" href="../articles/psut_names.html">PSUT Names</a>
    <a class="dropdown-item" href="../articles/specify.html">Specify EIOU Industries and Flows</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Specify EIOU Industries and Flows</h1>
                        <h4 data-toc-skip class="author">Matthew Kuperus
Heun</h4>
            
            <h4 data-toc-skip class="date">2023-11-06</h4>
      
      
      <div class="d-none name"><code>specify.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The IEA extended energy balance data include some <code>Flow</code>s
that are <code>Energy industry own use</code> (EIOU), the consumption of
energy by energy-producing industries. This vignette demonstrates how to
deal with the EIOU flows, especially if an analyst is moving toward
performing Physical Supply-Use Table (PSUT) analyses with the IEA data.
In particular, this vignette will identify some of the problems with
using such flows (as they are present in data from the IEA) and how to
use functions in the <code>IEATools</code> package to prepare for PSUT
analysis.</p>
<p>We’ll use data supplied with this package and accessed by the
<code><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df()</a></code> function to illustrate.</p>
<div class="section level3">
<h3 id="the-iea-approach-to-energy-industry-own-use-eiou-flows">The IEA approach to Energy Industry Own Use (EIOU) flows<a class="anchor" aria-label="anchor" href="#the-iea-approach-to-energy-industry-own-use-eiou-flows"></a>
</h3>
<p>The EIOU flows can be found as shown in the following code. The
<code>Flow</code> column indicates the industry to which EIOU of type
<code>Product</code> is flowing.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">IEATools</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="va">EIOU_flows</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flow.aggregation.point</span> <span class="op">==</span> <span class="st">"Energy industry own use"</span><span class="op">)</span></span>
<span><span class="va">EIOU_flows</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Year</span>, <span class="va">Flow</span>, <span class="va">Product</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 4</span></span></span>
<span><span class="co">#&gt;    Country  Year Flow                                        Product      </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> GHA      <span style="text-decoration: underline;">1</span>971 Oil refineries                              Refinery gas </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> GHA      <span style="text-decoration: underline;">2</span>000 Oil refineries                              Refinery gas </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> GHA      <span style="text-decoration: underline;">1</span>971 Own use in electricity, CHP and heat plants Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> GHA      <span style="text-decoration: underline;">2</span>000 Own use in electricity, CHP and heat plants Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZAF      <span style="text-decoration: underline;">1</span>971 Coal mines                                  Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZAF      <span style="text-decoration: underline;">2</span>000 Coal mines                                  Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZAF      <span style="text-decoration: underline;">2</span>000 Oil and gas extraction                      Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZAF      <span style="text-decoration: underline;">2</span>000 Coke ovens                                  Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZAF      <span style="text-decoration: underline;">2</span>000 Oil refineries                              Gas works gas</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZAF      <span style="text-decoration: underline;">2</span>000 Oil refineries                              Refinery gas </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZAF      <span style="text-decoration: underline;">1</span>971 Oil refineries                              Fuel oil     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZAF      <span style="text-decoration: underline;">2</span>000 Oil refineries                              Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZAF      <span style="text-decoration: underline;">1</span>971 Own use in electricity, CHP and heat plants Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> ZAF      <span style="text-decoration: underline;">2</span>000 Own use in electricity, CHP and heat plants Electricity  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ZAF      <span style="text-decoration: underline;">2</span>000 Pumped storage plants                       Electricity</span></span></code></pre></div>
<p>And <code>EIOU</code>-consuming industries can be found by the
following code.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EIOU_flows</span><span class="op">$</span><span class="va">Flow</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Oil refineries"                             </span></span>
<span><span class="co">#&gt; [2] "Own use in electricity, CHP and heat plants"</span></span>
<span><span class="co">#&gt; [3] "Coal mines"                                 </span></span>
<span><span class="co">#&gt; [4] "Oil and gas extraction"                     </span></span>
<span><span class="co">#&gt; [5] "Coke ovens"                                 </span></span>
<span><span class="co">#&gt; [6] "Pumped storage plants"</span></span></code></pre></div>
<p>Note that one of the industries that receives EIOU is
<code>Coal mines (energy)</code>, but coal is not produced by
<code>Coal mines (energy)</code> in the IEA data. (The suffix
<code>(energy)</code> indicates EIOU.) Rather, coal (of various types)
first appears in rows where the <code>Flow</code> is
<code>Production</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flow.aggregation.point</span> <span class="op">==</span> <span class="st">"Total primary energy supply"</span>,</span>
<span>         <span class="va">Product</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">coal_and_coal_products</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Flow.aggregation.point</span>, <span class="va">Flow</span>, <span class="va">Product</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt;   Country Flow.aggregation.point      Flow          Product                 </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZAF     Total primary energy supply Production    Hard coal (if no detail)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZAF     Total primary energy supply Production    Coking coal             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZAF     Total primary energy supply Production    Other bituminous coal   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZAF     Total primary energy supply Imports       Coking coal             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZAF     Total primary energy supply Exports       Hard coal (if no detail)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZAF     Total primary energy supply Exports       Coking coal             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> ZAF     Total primary energy supply Exports       Other bituminous coal   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> ZAF     Total primary energy supply Stock changes Other bituminous coal</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="problems-with-the-iea-approach-to-eiou">Problems with the IEA approach to EIOU<a class="anchor" aria-label="anchor" href="#problems-with-the-iea-approach-to-eiou"></a>
</h3>
<p>There are two problems with the IEA’s approach to energy industry own
use (EIOU).</p>
<ul>
<li>Assigning all originating flows to <code>Production</code> (as the
IEA does) means that some EIOU is routed to an industry that does not
produce anything. In the example above, <code>Electricity</code> is
routed to <code>Coal mines (energy)</code>, but coal is produced by
<code>Production</code>.</li>
<li>Furthermore, if all primary energy carriers originate at
<code>Production</code>, there will be problems with “upstream swims” in
an Input-Output analysis: demand for one primary energy carrier will
imply proportional demand for all other primary energy carriers.</li>
</ul>
</div>
<div class="section level3">
<h3 id="solving-the-problems-presented-by-the-ieas-approach-to-eiou">Solving the problems presented by the IEA’s approach to EIOU<a class="anchor" aria-label="anchor" href="#solving-the-problems-presented-by-the-ieas-approach-to-eiou"></a>
</h3>
<p>To solve these problems, the following fixed need to be
implemented:</p>
<ul>
<li>First, generic <code>Production</code> <code>Flow</code>s need to be
specified. In the example above, <code>coal_and_coal_product</code>s
should be produced by <code>Coal mines</code>, not the generic
<code>Production</code> industry. Likewise, <code>oil_product</code>s
should be produced by <code>Oil extraction</code>, and
<code>gas_product</code>s by <code>Natural gas extraction</code>. For
all other products, the production industry is named as
<code>Manufacture [of product]</code>.</li>
<li>Second, the resources matrix formulation needs to be implemented,
meaning that <code>Production</code> <code>Flow</code>s need to come
from resources industries, which supply resource-products, that are then
used in each of the manufacturing industries (<code>Coal mines</code>,
<code>Oil and gas extraction</code>, and
<code>Manufacture [of product]</code>) for manufacturing the actual
products.</li>
</ul>
<p>The <code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code> function accomplishes
these tasks.</p>
</div>
</div>
<div class="section level2">
<h2 id="specify-primary-production-specify_primary_production">Specify primary production
(<code>specify_primary_production()</code>)<a class="anchor" aria-label="anchor" href="#specify-primary-production-specify_primary_production"></a>
</h2>
<p>By default, the <code>specify_primary_produciton()</code> function
performs the following actions:</p>
<ul>
<li><p>First, <code>Production</code> <code>Flow</code>s for a given
<code>Product</code> are duplicated.</p></li>
<li><p>Second, the first duplicate of <code>Production</code>
<code>Flow</code>s for a given <code>Product</code> are replaced by a
<code>Resource [of Product]</code> <code>Flow</code>, which produces
<code>Product [from Resources]</code>.</p></li>
<li>
<p>Third, the second duplicate of <code>Production</code>
<code>Flow</code>s for a given <code>Product</code> are replaced by a
manufacturing industry flow, that takes as input the
<code>Product [from Resources]</code> supplied by the new
<code>Resource [of Product]</code> <code>Flow</code>, and that supplies
as output the actual <code>Product</code>. The manufacturing industry is
named:</p>
<ul>
<li>
<code>Coal mines</code> in the case of
<code>coal_and_coal_products</code>;</li>
<li>
<code>Oil extraction</code> in the case of
<code>oil_products</code>;</li>
<li>
<code>Natural gas extraction</code> in the case of
<code>natural_gas_products</code>;</li>
<li>
<code>Manufacture [of Product]</code> for all other products.</li>
</ul>
</li>
</ul>
<p>The code below demonstrates
<code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code>. Note that the
<code>Resources</code> <code>Flow</code>s are tagged as belonging to the
Resources matrix (<code>R</code>) by the
<code><a href="../reference/add_psut_matnames.html">add_psut_matnames()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Specific_primary_production</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_primary_production.html">specify_primary_production</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_psut_matnames.html">add_psut_matnames</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Specific_primary_production</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flow</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Resources (Coal)"</span>, <span class="st">"Resources (Oil and natural gas)"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Method</span>, <span class="op">-</span><span class="va">Last.stage</span>, <span class="op">-</span><span class="va">Energy.type</span>, <span class="op">-</span><span class="va">Ledger.side</span>, <span class="op">-</span><span class="va">Unit</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] Country                Year                   Flow.aggregation.point</span></span>
<span><span class="co">#&gt; [4] Flow                   Product                E.dot                 </span></span>
<span><span class="co">#&gt; [7] matnames              </span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre></div>
<p>Furthermore, the added flows from the <code>Resource</code>
industries are tagged as <code>Transformation processes</code> and
belong in the <code>U_feed</code> and <code>V</code> matrices. The EIOU
flows are shown to belong in the <code>U_EIOU</code> matrix.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Specific_primary_production</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flow</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Coal mines"</span>, <span class="st">"Oil and gas extraction"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Country Method Energy.type Last.stage Year Ledger.side</span></span>
<span><span class="co">#&gt; 1     ZAF    PCM           E      Final 1971      Supply</span></span>
<span><span class="co">#&gt; 2     ZAF    PCM           E      Final 1971      Supply</span></span>
<span><span class="co">#&gt; 3     ZAF    PCM           E      Final 1971      Supply</span></span>
<span><span class="co">#&gt; 4     ZAF    PCM           E      Final 2000      Supply</span></span>
<span><span class="co">#&gt; 5     ZAF    PCM           E      Final 2000      Supply</span></span>
<span><span class="co">#&gt; 6     ZAF    PCM           E      Final 2000      Supply</span></span>
<span><span class="co">#&gt; 7     ZAF    PCM           E      Final 2000      Supply</span></span>
<span><span class="co">#&gt; 8     ZAF    PCM           E      Final 2000      Supply</span></span>
<span><span class="co">#&gt; 9     ZAF    PCM           E      Final 2000      Supply</span></span>
<span><span class="co">#&gt;     Flow.aggregation.point                   Flow</span></span>
<span><span class="co">#&gt; 1  Energy industry own use             Coal mines</span></span>
<span><span class="co">#&gt; 2 Transformation processes             Coal mines</span></span>
<span><span class="co">#&gt; 3 Transformation processes             Coal mines</span></span>
<span><span class="co">#&gt; 4  Energy industry own use             Coal mines</span></span>
<span><span class="co">#&gt; 5  Energy industry own use Oil and gas extraction</span></span>
<span><span class="co">#&gt; 6 Transformation processes             Coal mines</span></span>
<span><span class="co">#&gt; 7 Transformation processes             Coal mines</span></span>
<span><span class="co">#&gt; 8 Transformation processes             Coal mines</span></span>
<span><span class="co">#&gt; 9 Transformation processes             Coal mines</span></span>
<span><span class="co">#&gt;                                     Product Unit       E.dot matnames</span></span>
<span><span class="co">#&gt; 1                               Electricity   TJ    -2192.40   U_EIOU</span></span>
<span><span class="co">#&gt; 2                  Hard coal (if no detail)   TJ  1384341.60        V</span></span>
<span><span class="co">#&gt; 3 Hard coal (if no detail) [from Resources]   TJ -1384341.60   U_feed</span></span>
<span><span class="co">#&gt; 4                               Electricity   TJ    -9939.60   U_EIOU</span></span>
<span><span class="co">#&gt; 5                               Electricity   TJ       -3.60   U_EIOU</span></span>
<span><span class="co">#&gt; 6                               Coking coal   TJ    99307.98        V</span></span>
<span><span class="co">#&gt; 7              Coking coal [from Resources]   TJ   -99307.98   U_feed</span></span>
<span><span class="co">#&gt; 8                     Other bituminous coal   TJ  5214842.61        V</span></span>
<span><span class="co">#&gt; 9    Other bituminous coal [from Resources]   TJ -5214842.61   U_feed</span></span>
<span><span class="va">Specific_primary_production</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flow.aggregation.point</span> <span class="op">==</span> <span class="st">"Energy industry own use"</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Year</span>, <span class="va">Flow</span>, <span class="va">Product</span>, <span class="va">E.dot</span>, <span class="va">matnames</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Country Year                                        Flow       Product</span></span>
<span><span class="co">#&gt; 1      GHA 1971                              Oil refineries  Refinery gas</span></span>
<span><span class="co">#&gt; 2      GHA 1971 Own use in electricity, CHP and heat plants   Electricity</span></span>
<span><span class="co">#&gt; 3      GHA 2000                              Oil refineries  Refinery gas</span></span>
<span><span class="co">#&gt; 4      GHA 2000 Own use in electricity, CHP and heat plants   Electricity</span></span>
<span><span class="co">#&gt; 5      ZAF 1971                                  Coal mines   Electricity</span></span>
<span><span class="co">#&gt; 6      ZAF 1971                              Oil refineries      Fuel oil</span></span>
<span><span class="co">#&gt; 7      ZAF 1971 Own use in electricity, CHP and heat plants   Electricity</span></span>
<span><span class="co">#&gt; 8      ZAF 2000                                  Coal mines   Electricity</span></span>
<span><span class="co">#&gt; 9      ZAF 2000                                  Coke ovens   Electricity</span></span>
<span><span class="co">#&gt; 10     ZAF 2000                      Oil and gas extraction   Electricity</span></span>
<span><span class="co">#&gt; 11     ZAF 2000                              Oil refineries   Electricity</span></span>
<span><span class="co">#&gt; 12     ZAF 2000                              Oil refineries Gas works gas</span></span>
<span><span class="co">#&gt; 13     ZAF 2000                              Oil refineries  Refinery gas</span></span>
<span><span class="co">#&gt; 14     ZAF 2000 Own use in electricity, CHP and heat plants   Electricity</span></span>
<span><span class="co">#&gt; 15     ZAF 2000                       Pumped storage plants   Electricity</span></span>
<span><span class="co">#&gt;          E.dot matnames</span></span>
<span><span class="co">#&gt; 1    -817.6988   U_EIOU</span></span>
<span><span class="co">#&gt; 2    -104.4020   U_EIOU</span></span>
<span><span class="co">#&gt; 3   -1106.2991   U_EIOU</span></span>
<span><span class="co">#&gt; 4    -158.3992   U_EIOU</span></span>
<span><span class="co">#&gt; 5   -2192.4000   U_EIOU</span></span>
<span><span class="co">#&gt; 6  -24280.8000   U_EIOU</span></span>
<span><span class="co">#&gt; 7  -12787.2000   U_EIOU</span></span>
<span><span class="co">#&gt; 8   -9939.6000   U_EIOU</span></span>
<span><span class="co">#&gt; 9      -3.6000   U_EIOU</span></span>
<span><span class="co">#&gt; 10     -3.6000   U_EIOU</span></span>
<span><span class="co">#&gt; 11 -47991.6000   U_EIOU</span></span>
<span><span class="co">#&gt; 12    -24.3000   U_EIOU</span></span>
<span><span class="co">#&gt; 13 -44059.6000   U_EIOU</span></span>
<span><span class="co">#&gt; 14 -44067.6000   U_EIOU</span></span>
<span><span class="co">#&gt; 15  -2322.0000   U_EIOU</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="convert-production-to-resources-specify_production_to_resources">Convert <code>Production</code> to <code>Resources</code>
(<code>specify_production_to_resources()</code>)<a class="anchor" aria-label="anchor" href="#convert-production-to-resources-specify_production_to_resources"></a>
</h2>
<p>The IEA extended energy balances give resource extraction in rows
where the <code>Flow</code> is “<code>Production</code>”.
<code><a href="../reference/specify_production_to_resources.html">specify_production_to_resources()</a></code> changes the
“<code>Production</code>” string to “<code>Resources (product)</code>”,
where <code>product</code> is the name of the energy carrier for this
resource. <code><a href="../reference/specify_production_to_resources.html">specify_production_to_resources()</a></code> should be
called <em>after</em> <code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code>, which
adjusts for energy industry own use of some primary energy producing
industries. If this function is called first, energy industry own use
will not be accounted correctly.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_primary_production.html">specify_primary_production</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_production_to_resources.html">specify_production_to_resources</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">startsWith</a></span><span class="op">(</span><span class="va">Flow</span>, <span class="st">"Resources"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 15</span></span>
<span><span class="co">#&gt; Columns: 11</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "GHA", "GHA", "GHA", "GHA", "ZAF", "ZAF", "ZAF"…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Last.stage             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1971, 1971, 2000, 2000, 1971, 1971, 1971, 2000,…</span></span>
<span><span class="co">#&gt; $ Ledger.side            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Supply", "Supply", "Supply", "Supply", "Supply…</span></span>
<span><span class="co">#&gt; $ Flow.aggregation.point <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Total primary energy supply", "Total primary e…</span></span>
<span><span class="co">#&gt; $ Flow                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Resources [of Hydro]", "Resources [of Primary …</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Hydro [from Resources]", "Primary solid biofue…</span></span>
<span><span class="co">#&gt; $ Unit                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "TJ", "TJ", "TJ", "TJ", "TJ", "TJ", "TJ", "TJ",…</span></span>
<span><span class="co">#&gt; $ E.dot                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 10472.40, 87400.00, 23792.40, 162909.00, 138434…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="be-more-specific-about-interface-industries-specify_interface_industries">Be more specific about interface industries
(<code>specify_interface_industries()</code>)<a class="anchor" aria-label="anchor" href="#be-more-specific-about-interface-industries-specify_interface_industries"></a>
</h2>
<p>An interface industry is one that moves energy carriers into or out
of a country. When <code>Flow</code> is any of the interface industries,
we need to be more specific. If we don’t separate these
<code>Flow</code>s by <code>Product</code>, we run into trouble in the
PSUT framework:</p>
<ul>
<li>upstream swims will result in all <code>Product</code>s being
produced even if only one is needed and</li>
<li>embodied energy calculations will result in many types of energy
being embodied, even if only one should be.</li>
</ul>
<p>To solve these problems, <code><a href="../reference/specify_interface_industries.html">specify_interface_industries()</a></code>
adds a suffix <code>(Product)</code> to each of these interface
industries.</p>
<p>Note that “<code>Production</code>” <code>Flow</code>s also needs to
be specified, but that is accomplished in the
<code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code> and
<code><a href="../reference/specify_production_to_resources.html">specify_production_to_resources()</a></code> functions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_interface_industries.html">specify_interface_industries</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/starts_with_any_of.html">starts_with_any_of</a></span><span class="op">(</span><span class="va">Flow</span>, <span class="fu">IEATools</span><span class="fu">::</span><span class="va"><a href="../reference/interface_industries.html">interface_industries</a></span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 69</span></span>
<span><span class="co">#&gt; Columns: 11</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "GHA", "GHA", "GHA", "GHA", "GHA", "GHA", "GHA"…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Last.stage             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1971, 2000, 2000, 2000, 1971, 2000, 1971, 2000,…</span></span>
<span><span class="co">#&gt; $ Ledger.side            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Supply", "Supply", "Supply", "Supply", "Supply…</span></span>
<span><span class="co">#&gt; $ Flow.aggregation.point <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Total primary energy supply", "Total primary e…</span></span>
<span><span class="co">#&gt; $ Flow                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Imports [of Crude oil]", "Imports [of Crude oi…</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Crude oil", "Crude oil", "Liquefied petroleum …</span></span>
<span><span class="co">#&gt; $ Unit                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "TJ", "TJ", "TJ", "TJ", "TJ", "TJ", "TJ", "TJ",…</span></span>
<span><span class="co">#&gt; $ E.dot                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 38359.8007, 54769.2683, 1655.4984, 18009.5997, …</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="be-more-specific-about-transformation-process-energy-industry-own-use-specify_tp_eiou">Be more specific about Transformation process Energy industry own
use (<code>specify_tp_eiou()</code>)<a class="anchor" aria-label="anchor" href="#be-more-specific-about-transformation-process-energy-industry-own-use-specify_tp_eiou"></a>
</h2>
<p>The extended energy balance data from the IEA present some issues
when linking “Energy Industry Own Use” (EIOU) flows to “Transformation
processes” flows:</p>
<ol style="list-style-type: decimal">
<li>In some instances the data includes “Energy industry own use” (EIOU)
flows for industries that are not described as transformation processes.
For instance, the “Nuclear industry” appears as an EIOU flow but does
not appear as a transformation process.</li>
<li>In some other instances the data includes transformation processes
for which no “Energy Industry Own Use” flow is reported. For instance,
the “Main activity producer electricity plants” is a transformation
process, but no EIOU is associated.</li>
</ol>
<p>The <code>specify_tp_eiou</code> function enables to deal with these
inconsistencies. Effectively, it is a convenience function that bundles
together several other functions:</p>
<ol style="list-style-type: decimal">
<li><code><a href="../reference/gather_producer_autoproducer.html">gather_producer_autoproducer()</a></code></li>
<li><code><a href="../reference/route_pumped_storage.html">route_pumped_storage()</a></code></li>
<li><code><a href="../reference/split_oil_gas_extraction_eiou.html">split_oil_gas_extraction_eiou()</a></code></li>
<li><code><a href="../reference/route_own_use_elect_chp_heat.html">route_own_use_elect_chp_heat()</a></code></li>
<li><code><a href="../reference/add_nuclear_industry.html">add_nuclear_industry()</a></code></li>
<li><code><a href="../reference/route_non_specified_eiou.html">route_non_specified_eiou()</a></code></li>
<li><code><a href="../reference/route_non_specified_tp.html">route_non_specified_tp()</a></code></li>
</ol>
<p>Details can be found in the documentation of each function, but
essentially they do the following:</p>
<ol style="list-style-type: decimal">
<li>The <code><a href="../reference/gather_producer_autoproducer.html">gather_producer_autoproducer()</a></code> function gathers
<em>separately</em> the transformation processes “Main activity producer
plants” and “Autoproducer plants” for each of three types: electricity,
heat, and CHP.</li>
<li>The <code><a href="../reference/route_pumped_storage.html">route_pumped_storage()</a></code> function routes the “Pumped
storage plants” EIOU flow to “Main activity producer electricity
plants.”</li>
<li>The <code><a href="../reference/route_own_use_elect_chp_heat.html">route_own_use_elect_chp_heat()</a></code> routes the “Own use
in electricity, heat and CHP plants” EIOU flow to “Main activity
producer electricity plants”, “Main activity producer CHP plants,” and
“Main activity producer heat plants.” It does so according to either the
input or output shares of each of the industries, depending on the
arguments of the function.</li>
<li>The <code><a href="../reference/split_oil_gas_extraction_eiou.html">split_oil_gas_extraction_eiou()</a></code> function splits the
EIOU of “Oil and gas extraction” in EIOU of “Oil extraction” and EIOU of
“Natural gas extraction”, by using the shares of production of each of
these industries, meaning that the ratio EIOU to output is the same for
“Oil extraction” and “Natural gas extraction”.</li>
<li>The <code><a href="../reference/add_nuclear_industry.html">add_nuclear_industry()</a></code> function adds a nuclear
industry in transformation processes, and modifies each of the “Main
activity producer electricity plants” and “Main activity producer CHP
plants” according to their inputs of nuclear fuel as reported by the
IEA.</li>
<li>The <code><a href="../reference/route_non_specified_eiou.html">route_non_specified_eiou()</a></code> function routes the
“Non-specified” EIOU flow to the different EIOU industries. It performs
the split according to the shares of use of EIOU of all EIOU industries
(excluding the non-specified one).</li>
<li>The <code><a href="../reference/route_non_specified_tp.html">route_non_specified_tp()</a></code> function routes the
“Non-specified” transformation processes flows to the different
transformation processes industries. It performs the split according to
the shares of use and supply of each product, by each transformation
process industry (excluding the non-specified one).</li>
</ol>
<p>The following two pieces of code are therefore equivalent:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_tp_eiou.html">specify_tp_eiou</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 398</span></span>
<span><span class="co">#&gt; Columns: 11</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "GHA", "GHA", "GHA", "GHA", "GHA", "GHA", "GHA"…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Last.stage             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1971, 1971, 1971, 1971, 1971, 1971, 1971, 1971,…</span></span>
<span><span class="co">#&gt; $ Ledger.side            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Consumption", "Consumption", "Consumption", "C…</span></span>
<span><span class="co">#&gt; $ Flow.aggregation.point <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Industry", "Industry", "Industry", "Industry",…</span></span>
<span><span class="co">#&gt; $ Flow                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Industry not elsewhere specified", "Industry n…</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Electricity", "Fuel oil", "Gas/diesel oil excl…</span></span>
<span><span class="co">#&gt; $ Unit                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "TJ", "TJ", "TJ", "TJ", "TJ", "TJ", "TJ", "TJ",…</span></span>
<span><span class="co">#&gt; $ E.dot                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 918.0020, 3698.4014, 1645.3998, 6100.0001, 698.…</span></span>
<span></span>
<span><span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/gather_producer_autoproducer.html">gather_producer_autoproducer</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/route_pumped_storage.html">route_pumped_storage</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/split_oil_gas_extraction_eiou.html">split_oil_gas_extraction_eiou</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/route_own_use_elect_chp_heat.html">route_own_use_elect_chp_heat</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/add_nuclear_industry.html">add_nuclear_industry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/route_non_specified_eiou.html">route_non_specified_eiou</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/route_non_specified_tp.html">route_non_specified_tp</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 398</span></span>
<span><span class="co">#&gt; Columns: 11</span></span>
<span><span class="co">#&gt; $ Country                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "GHA", "GHA", "GHA", "GHA", "GHA", "GHA", "GHA"…</span></span>
<span><span class="co">#&gt; $ Method                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "PCM", "PCM", "PCM", "PCM", "PCM", "PCM", "PCM"…</span></span>
<span><span class="co">#&gt; $ Energy.type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "E", "E", "E", "E", "E", "E", "E", "E", "E", "E…</span></span>
<span><span class="co">#&gt; $ Last.stage             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Final", "Final", "Final", "Final", "Final", "F…</span></span>
<span><span class="co">#&gt; $ Year                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1971, 1971, 1971, 1971, 1971, 1971, 1971, 1971,…</span></span>
<span><span class="co">#&gt; $ Ledger.side            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Consumption", "Consumption", "Consumption", "C…</span></span>
<span><span class="co">#&gt; $ Flow.aggregation.point <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Industry", "Industry", "Industry", "Industry",…</span></span>
<span><span class="co">#&gt; $ Flow                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Industry not elsewhere specified", "Industry n…</span></span>
<span><span class="co">#&gt; $ Product                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Electricity", "Fuel oil", "Gas/diesel oil excl…</span></span>
<span><span class="co">#&gt; $ Unit                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "TJ", "TJ", "TJ", "TJ", "TJ", "TJ", "TJ", "TJ",…</span></span>
<span><span class="co">#&gt; $ E.dot                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 918.0020, 3698.4014, 1645.3998, 6100.0001, 698.…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="identify-transformation-process-sinks-and-sources-tp_sinks_sources">Identify Transformation process sinks and sources
(<code>tp_sinks_sources()</code>)<a class="anchor" aria-label="anchor" href="#identify-transformation-process-sinks-and-sources-tp_sinks_sources"></a>
</h2>
<p>In the IEA extended energy balance data, transformation processes
(tp) ought to both consume and produce energy. But some transformation
processes consume energy without producing any energy; others produce
without consuming. Such transformation processes can be called
“transformation sinks” and “transformation sources,” respectively. This
function finds and identifies transformation processes that act as sinks
or sources.</p>
<p>It is important to identify transformation sinks, because they cause
two problems for physical supply-use table (PSUT) analysis. First, when
swimming upstream, a PSUT analysis cannot “see” the sunk energy
carriers, because they have no downstream effects. Thus, upstream swims
cannot conserve energy. Second, when calculating embodied energy for
each downstream energy carrier, the sunk energy carriers cannot be
embodied in any final demand energy carriers. Thus, embodied energy
calculations cannot conserve energy.</p>
<p>Transformation sources can also cause problems for physical
supply-use table (PSUT) analysis. In particular, when swimming upstream,
a PSUT analysis will “see” the final energy sources, but cannot see any
associated primary energy carriers.</p>
<p>Transformation sinks and sources are identified by the following
algorithm:</p>
<ol style="list-style-type: decimal">
<li>Identify (per group in <code>.tidy_iea_df</code>) all
<code>Transformation processes</code> that consume energy (negative
value for <code>E.dot</code>). Energy consumption can be for the
transformation process itself or for Energy industry own use.</li>
<li>Identify (per group in <code>.tidy_iea_df</code>) all
<code>Transformation processes</code> that produce energy (positive
value for <code>E.dot</code>).</li>
<li>Take the set difference between the two (consumers less producers
for sinks and producers less consumers for sources). The set difference
is the list of transformation sinks or sources, respectively.</li>
</ol>
<p><code><a href="../reference/tp_sinks_sources.html">tp_sinks_sources()</a></code> is a function not unlike
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise()</a></code>; it returns a summary containing
grouping variables and industries that are transformation sinks or
sources. The various <code>specify_*()</code> functions should also be
called <em>before</em> calling [tp_sinks_sources()]. The
<code>specify_*()</code> functions clean up the IEA data, ensuring that
energy is routed to the right places.</p>
<p>Note that this function only identifies transformation sinks or
sources; it does not fix the problem. To solve the problem of
transformation sinks, see the [tp_sinks_to_nonenergy()] function.
<code><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy()</a></code> uses the output of
<code><a href="../reference/tp_sinks_sources.html">tp_sinks_sources()</a></code> to route energy consumed by
transformation sinks to
<code>Non-energy use industry/transformation/energy</code>. There is no
function to solve the problem of transformation sources at this
time.</p>
<p><code><a href="../reference/tp_sinks_sources.html">tp_sinks_sources()</a></code> returns metadata columns and the
<code>Flow</code> column. The <code>Flow</code> column contains
industries that are sinks or sources, depending on the value of the
<code>type</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The included data sets to not have any transformation process sinks or sources.</span></span>
<span><span class="co"># Demonstrate with a made-up data set.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Automobiles"</span>, <span class="st">"Automobiles"</span>, <span class="st">"Furnaces"</span><span class="op">)</span>,</span>
<span>                   E.dot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Country <span class="op">=</span> <span class="st">"A country"</span>,</span>
<span>    Flow.aggregation.point <span class="op">=</span> <span class="st">"Transformation processes"</span>,</span>
<span>    Product <span class="op">=</span> <span class="st">"A product"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Automobiles both consume and produce energy,</span></span>
<span>  <span class="co"># so Automobiles are not reported by tp_sinks_sources.</span></span>
<span>  <span class="co"># However, Furnaces make Product without consuming any energy,</span></span>
<span>  <span class="co"># and are, therefore, a transformation source.</span></span>
<span>  <span class="fu"><a href="../reference/tp_sinks_sources.html">tp_sinks_sources</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"sources"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   Country   Flow    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A country Furnaces</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="convert-transformation-process-sinks-to-non-energy-flows-tp_sinks_to_nonenergy">Convert Transformation process sinks to Non-energy flows
(<code>tp_sinks_to_nonenergy()</code> )<a class="anchor" aria-label="anchor" href="#convert-transformation-process-sinks-to-non-energy-flows-tp_sinks_to_nonenergy"></a>
</h2>
<p>This function reclassifies energy flowing into transformation process
sinks as <code>non_energy_flow</code>, by default “Non-energy use in
industry/transformation/energy”. If there was already some Non-energy
use, the new Non-energy use is added to the existing Non-energy use.</p>
<p><code><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy()</a></code> uses the
<code><a href="../reference/tp_sinks_sources.html">tp_sinks_sources()</a></code> function internally to identify
transformation process sinks.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Ledger.side <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Supply"</span>, <span class="st">"Supply"</span>, <span class="st">"Supply"</span>, <span class="st">"Consumption"</span><span class="op">)</span>,</span>
<span>  Flow.aggregation.point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Transformation processes"</span>,</span>
<span>                             <span class="st">"Transformation processes"</span>,</span>
<span>                             <span class="st">"Transformation processes"</span>,</span>
<span>                             <span class="st">"Non-energy use"</span><span class="op">)</span>,</span>
<span>  Flow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Automobiles"</span>, <span class="st">"Automobiles"</span>, <span class="st">"Furnaces"</span>,</span>
<span>           <span class="st">"Non-energy use industry/transformation/energy"</span><span class="op">)</span>,</span>
<span>  Product <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Petrol"</span>, <span class="st">"MD"</span>, <span class="st">"Coal"</span>, <span class="st">"Coal"</span><span class="op">)</span>,</span>
<span>  E.dot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Method <span class="op">=</span> <span class="st">"PCM"</span>,</span>
<span>    Last.stage <span class="op">=</span> <span class="st">"Final"</span>,</span>
<span>    Energy.type <span class="op">=</span> <span class="st">"E"</span>,</span>
<span>    Country <span class="op">=</span> <span class="st">"Bogus"</span>,</span>
<span>    Year <span class="op">=</span> <span class="fl">1971</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">DF</span></span>
<span><span class="co">#&gt;   Ledger.side   Flow.aggregation.point</span></span>
<span><span class="co">#&gt; 1      Supply Transformation processes</span></span>
<span><span class="co">#&gt; 2      Supply Transformation processes</span></span>
<span><span class="co">#&gt; 3      Supply Transformation processes</span></span>
<span><span class="co">#&gt; 4 Consumption           Non-energy use</span></span>
<span><span class="co">#&gt;                                            Flow Product E.dot Method Last.stage</span></span>
<span><span class="co">#&gt; 1                                   Automobiles  Petrol    -1    PCM      Final</span></span>
<span><span class="co">#&gt; 2                                   Automobiles      MD     1    PCM      Final</span></span>
<span><span class="co">#&gt; 3                                      Furnaces    Coal    -2    PCM      Final</span></span>
<span><span class="co">#&gt; 4 Non-energy use industry/transformation/energy    Coal     8    PCM      Final</span></span>
<span><span class="co">#&gt;   Energy.type Country Year</span></span>
<span><span class="co">#&gt; 1           E   Bogus 1971</span></span>
<span><span class="co">#&gt; 2           E   Bogus 1971</span></span>
<span><span class="co">#&gt; 3           E   Bogus 1971</span></span>
<span><span class="co">#&gt; 4           E   Bogus 1971</span></span>
<span><span class="co"># In this example, Furnaces are a transformation process sink:</span></span>
<span><span class="co"># they consume Coal but produce nothing.</span></span>
<span><span class="co"># There are already 8 units of Coal consumption for Non-energy uses.</span></span>
<span><span class="co"># The 2 units of Coal are added to the existing 8 units</span></span>
<span><span class="co"># Non-energy consumption to make 10 units of Non-energy consumption.</span></span>
<span><span class="va">DF</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Ledger.side   Flow.aggregation.point</span></span>
<span><span class="co">#&gt; 1      Supply Transformation processes</span></span>
<span><span class="co">#&gt; 2      Supply Transformation processes</span></span>
<span><span class="co">#&gt; 3 Consumption           Non-energy use</span></span>
<span><span class="co">#&gt;                                            Flow Product E.dot Method Last.stage</span></span>
<span><span class="co">#&gt; 1                                   Automobiles  Petrol    -1    PCM      Final</span></span>
<span><span class="co">#&gt; 2                                   Automobiles      MD     1    PCM      Final</span></span>
<span><span class="co">#&gt; 3 Non-energy use industry/transformation/energy    Coal    10    PCM      Final</span></span>
<span><span class="co">#&gt;   Energy.type Country Year</span></span>
<span><span class="co">#&gt; 1           E   Bogus 1971</span></span>
<span><span class="co">#&gt; 2           E   Bogus 1971</span></span>
<span><span class="co">#&gt; 3           E   Bogus 1971</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="put-it-all-together-specify_all">Put it all together (<code>specify_all()</code>)<a class="anchor" aria-label="anchor" href="#put-it-all-together-specify_all"></a>
</h2>
<p><code><a href="../reference/specify_all.html">specify_all()</a></code> is a convenience function that bundles
several others:</p>
<ol style="list-style-type: decimal">
<li><code><a href="../reference/specify_primary_production.html">specify_primary_production()</a></code></li>
<li><code><a href="../reference/specify_production_to_resources.html">specify_production_to_resources()</a></code></li>
<li><code><a href="../reference/specify_tp_eiou.html">specify_tp_eiou()</a></code></li>
<li><code><a href="../reference/specify_interface_industries.html">specify_interface_industries()</a></code></li>
<li><code><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy()</a></code></li>
</ol>
<p>Each bundled function is called in turn using default arguments.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_all.html">specify_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">Complicated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_primary_production.html">specify_primary_production</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_production_to_resources.html">specify_production_to_resources</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_tp_eiou.html">specify_tp_eiou</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/specify_interface_industries.html">specify_interface_industries</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/tp_sinks_to_nonenergy.html">tp_sinks_to_nonenergy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">Simple</span> <span class="op">==</span> <span class="va">Complicated</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrated how to specify details of primary and
transformation process flows. The next step could be to prepare the IEA
data for use within the PSUT framework. For details, see the <a href="https://matthewheun.github.io/IEATools/articles/prep_psut.html" class="external-link">Prep
PSUT</a> vignette.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew Heun, Emmanuel Aramendia, Zeke Marshall.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
