<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IEATools • IEATools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="IEATools">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IEATools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/IEATools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>IEATools</h1>
                        <h4 class="author">Matthew Kuperus Heun</h4>
            
            <h4 class="date">2019-03-17</h4>
      
      
      <div class="hidden name"><code>IEATools.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>IEATools</code> is an <code>R</code> package that provides functions to analyze extended energy balance data from the <a href="https://www.iea.org">International Energy Agency (IEA)</a>. The IEA’s data are not free. But if you have access to the data, you can following the instructions in this vignette to analyze IEA data.</p>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h2>
<p>To get started, data must be obtained and pulled into an R data frame.</p>
<div id="obtain-iea-data" class="section level3">
<h3 class="hasAnchor">
<a href="#obtain-iea-data" class="anchor"></a>Obtain IEA data</h3>
<p>Purchase the IEA extended energy balances product from (<a href="http://data.iea.org" class="uri">http://data.iea.org</a>). Download the complete extended energy balance data for at least one country in a .csv file format as shown in the following figure.</p>
<div class="figure">
<img src="figs/original_header.pdf" alt="IEA extended energy balance data format." width="100%"><p class="caption">
IEA extended energy balance data format.
</p>
</div>
<p>Example data from two countries for two years are provided in the package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(IEATools)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># Define the file location</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">IEA_path &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"extdata"</span>, <span class="st">"GH-ZA-ktoe-Extended-Energy-Balances-sample.csv"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="dt">package =</span> <span class="st">"IEATools"</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readChar">readChar</a></span>(IEA_path, <span class="dt">nchars =</span> <span class="dv">256</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; [1] ",,TIME,1971,2000\r\nCOUNTRY,FLOW,PRODUCT,,\r\nGhana,Production,Hard coal (if no detail),0,x\r\nGhana,Production,Brown coal (if no detail),0,x\r\nGhana,Production,Anthracite,..,0\r\nGhana,Production,Coking coal,..,0\r\nGhana,Production,Other bituminous coal,..,0\r\nGhana"</span></a></code></pre></div>
</div>
<div id="convert-the-iea-data-into-an-r-data-frame" class="section level3">
<h3 class="hasAnchor">
<a href="#convert-the-iea-data-into-an-r-data-frame" class="anchor"></a>Convert the IEA data into an R data frame</h3>
<p>The extended energy balance data can be pulled directly into an <code>R</code> data frame by the <code><a href="../reference/iea_df.html">iea_df()</a></code> function. <code><a href="../reference/iea_df.html">iea_df()</a></code> fixes the header shown in the figure above, conveting the header into a single row. Furthermore, the IEA data have indicators for not applicable values (“<code>x</code>”) and for unavailable values (“<code>..</code>”). (See “World Energy Balances: Database Documentation (2018 edition)” at (<a href="http://wds.iea.org/wds/pdf/worldbal_documentation.pdf" class="uri">http://wds.iea.org/wds/pdf/worldbal_documentation.pdf</a>).)</p>
<p><code>R</code> has three concepts that could be used for “<code>x</code>” and “<code>..</code>”: <code>0</code> would indicate value known to be zero. <code>NULL</code> would indicate an undefined value. <code>NA</code> would indicate a value that is unavailable.</p>
<p>In theory, mapping from the IEA’s indicators to <code>R</code> should proceed as follows: “<code>..</code>” (unavailable) in the IEA data would be converted to <code>NA</code> in <code>R</code>. “<code>x</code>” (not applicable) in the IEA data would be converted to <code>0</code> in <code>R</code>. “<code>NULL</code>” would not be used. However, the IEA are not consistent with their coding. In some places “<code>..</code>” is used for not applicable values (e.g., World Anthracite supply in 1971). World Anthracite supply in 1971 is actually not applicable, because Anthracite was classified under “Hard coal (if no detail)” in 1971. On the other hand, “<code>..</code>” is used for data in the most recent year when those data have not yet been incorporated into the database.</p>
<p>In the face of IEA’s inconsistencies, the only rational way to proceed is to convert both “<code>x</code>” and “<code>..</code>” to “<code>0</code>”. <code><a href="../reference/iea_df.html">iea_df()</a></code> performs that task.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">IEA_data &lt;-<span class="st"> </span>IEA_path <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/iea_df.html">iea_df</a></span>()</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">IEA_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; Observations: 14,688</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; Variables: 5</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; $ COUNTRY &lt;chr&gt; "Ghana", "Ghana", "Ghana", "Ghana", "Ghana", "Ghana", "G…</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; $ FLOW    &lt;chr&gt; "Production", "Production", "Production", "Production", …</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; $ PRODUCT &lt;chr&gt; "Hard coal (if no detail)", "Brown coal (if no detail)",…</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; $ `1971`  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; $ `2000`  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a></code></pre></div>
</div>
</div>
<div id="next-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next steps</h2>
<p>There are several reasons why the IEA extended energy balance data are not convenient for immediate use.</p>
<ol style="list-style-type: decimal">
<li>Column titles are SHOUTING.</li>
<li>The <code>COUNTRY</code> column contains full (long) country names. It would be nicer if countries were identified by their <a href="https://en.wikipedia.org/wiki/ISO_3166-1">2-letter ISO codes</a>.</li>
<li>The demarcation between the supply and consumptions sides of the ledger is unclear to new users.</li>
<li>How data should be aggregated is unclear to new users.</li>
<li>The data are not in <a href="https://doi.org/10.18637/jss.v059.i10">tidy format</a>.</li>
</ol>
<p>The <code>IEATools</code> package has functions to address each of these issues.</p>
<div id="fix-column-titles" class="section level3">
<h3 class="hasAnchor">
<a href="#fix-column-titles" class="anchor"></a>Fix column titles</h3>
<p>To unshout the column titles, use the <code><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols()</a></code> function. Column names changed by <code><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols()</a></code> are the defaults for arguments to other functions.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">IEA_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; Observations: 14,688</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; Variables: 5</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; $ Country &lt;chr&gt; "Ghana", "Ghana", "Ghana", "Ghana", "Ghana", "Ghana", "G…</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; $ Flow    &lt;chr&gt; "Production", "Production", "Production", "Production", …</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; $ Product &lt;chr&gt; "Hard coal (if no detail)", "Brown coal (if no detail)",…</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; $ `1971`  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; $ `2000`  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a></code></pre></div>
<p>Note that the example above uses the <code><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols()</a></code> function without arguments, because the default arguments are correct for the extended energy balance data as it arrives from the IEA. However, both the old and new names can be specified as arguments. If you despise both capitals letters and vowels, you could do the following.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">IEA_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols</a></span>(<span class="dt">new_country =</span> <span class="st">"cntry"</span>, <span class="dt">new_flow =</span> <span class="st">"flw"</span>, <span class="dt">new_product =</span> <span class="st">"prdct"</span>)  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; Observations: 14,688</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; Variables: 5</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; $ cntry  &lt;chr&gt; "Ghana", "Ghana", "Ghana", "Ghana", "Ghana", "Ghana", "Gh…</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; $ flw    &lt;chr&gt; "Production", "Production", "Production", "Production", "…</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; $ prdct  &lt;chr&gt; "Hard coal (if no detail)", "Brown coal (if no detail)", …</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; $ `1971` &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; $ `2000` &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</span></a></code></pre></div>
<p>The default arguments are consistent throughout the <code>IEATools</code> package. Thus, it is recommended that you use the default argument values, wherever possible.</p>
</div>
<div id="change-to-2-letter-iso-country-abbreviations" class="section level3">
<h3 class="hasAnchor">
<a href="#change-to-2-letter-iso-country-abbreviations" class="anchor"></a>Change to 2-letter ISO country abbreviations</h3>
<p>To reduce the length of character strings representing countries, the <code><a href="../reference/use_iso_countries.html">use_iso_countries()</a></code> function replaces country character strings with each country’s 2-letter abbreviation.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">IEA_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/use_iso_countries.html">use_iso_countries</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; Observations: 14,688</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; Variables: 5</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; $ Country &lt;chr&gt; "GH", "GH", "GH", "GH", "GH", "GH", "GH", "GH", "GH", "G…</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; $ Flow    &lt;chr&gt; "Production", "Production", "Production", "Production", …</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; $ Product &lt;chr&gt; "Hard coal (if no detail)", "Brown coal (if no detail)",…</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; $ `1971`  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; $ `2000`  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a></code></pre></div>
</div>
<div id="remove-aggregation-and-memo-data" class="section level3">
<h3 class="hasAnchor">
<a href="#remove-aggregation-and-memo-data" class="anchor"></a>Remove aggregation and memo data</h3>
<p>The IEA’s extended energy balances contain many memos and aggregations in the data itself. For the purposes of manipulations and calculations, it is often advisable to remove all memos and aggregations. The <code><a href="../reference/remove_agg_memo_flows.html">remove_agg_memo_flows()</a></code> function performs that task.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">IEA_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Flow <span class="op">==</span><span class="st"> "Total primary energy supply"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; Observations: 136</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; Variables: 5</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; $ Country &lt;chr&gt; "Ghana", "Ghana", "Ghana", "Ghana", "Ghana", "Ghana", "G…</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; $ Flow    &lt;chr&gt; "Total primary energy supply", "Total primary energy sup…</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; $ Product &lt;chr&gt; "Hard coal (if no detail)", "Brown coal (if no detail)",…</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; $ `1971`  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; $ `2000`  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co"># Total primary energy supply is an aggregation row,</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co"># so its rows should be absent after calling remove_agg_memo_flows().</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14">IEA_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="../reference/remove_agg_memo_flows.html">remove_agg_memo_flows</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Flow <span class="op">==</span><span class="st"> "Total primary energy supply"</span>)</a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt; [1] Country Flow    Product 1971    2000   </span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></a></code></pre></div>
</div>
<div id="augment-with-ledger-side-and-aggregation-point-information" class="section level3">
<h3 class="hasAnchor">
<a href="#augment-with-ledger-side-and-aggregation-point-information" class="anchor"></a>Augment with ledger side and aggregation point information</h3>
<p>In the IEA’s extended energy balance data can be confusing for first-time users to understand. In particular, the demarcation between the supply and consumption sides of the ledger is unclear. And how data should be aggregated is also unclear. To clarify these issues and make later aggregation calculations possible, call the <code>augment_iea_data()</code> function. <code><a href="../reference/augment_iea_df.html">augment_iea_df()</a></code> has many default arguments that work fine for the as-delivered data. <code><a href="../reference/augment_iea_df.html">augment_iea_df()</a></code> adds new columns <code>Ledger.side</code>, <code>Flow.aggregation.point</code>, <code>Energy.type</code>, and <code>Unit</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">IEA_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/augment_iea_df.html">augment_iea_df</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; Observations: 14,688</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; Variables: 9</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; $ Country                &lt;chr&gt; "Ghana", "Ghana", "Ghana", "Ghana", "Ghan…</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt; $ Ledger.side            &lt;chr&gt; "Supply", "Supply", "Supply", "Supply", "…</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt; $ Flow.aggregation.point &lt;chr&gt; "Total primary energy supply", "Total pri…</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; $ Energy.type            &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E", "…</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; $ Unit                   &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "…</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; $ Flow                   &lt;chr&gt; "Production", "Production", "Production",…</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; $ Product                &lt;chr&gt; "Hard coal (if no detail)", "Brown coal (…</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; $ `1971`                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; $ `2000`                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></a></code></pre></div>
</div>
<div id="convert-to-a-tidy-data-frame" class="section level3">
<h3 class="hasAnchor">
<a href="#convert-to-a-tidy-data-frame" class="anchor"></a>Convert to a tidy data frame</h3>
<p>The <a href="https://doi.org/10.18637/jss.v059.i10">tidy format</a> for data is a data frame where each datum is located on its own row. As delivered, the IEA’s data are not tidy: years are spread out as columns rather than being a column to themselves so that each datum occupies one row. The <code><a href="../reference/tidy_iea_df.html">tidy_iea_df()</a></code> function converts to a tidy format. By default, <code><a href="../reference/tidy_iea_df.html">tidy_iea_df()</a></code> removes zeroes from the data frame, thereby reducing memory footprint.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">Tidy_IEA_df &lt;-<span class="st"> </span>IEA_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/use_iso_countries.html">use_iso_countries</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/remove_agg_memo_flows.html">remove_agg_memo_flows</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/augment_iea_df.html">augment_iea_df</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/tidy_iea_df.html">tidy_iea_df</a></span>()</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">Tidy_IEA_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; Observations: 399</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; Variables: 9</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; $ Country                &lt;chr&gt; "GH", "GH", "GH", "GH", "GH", "GH", "GH",…</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt; $ Year                   &lt;chr&gt; "1971", "1971", "1971", "1971", "1971", "…</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; $ Ledger.side            &lt;chr&gt; "Supply", "Supply", "Supply", "Supply", "…</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; $ Flow.aggregation.point &lt;chr&gt; "Total primary energy supply", "Total pri…</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; $ Energy.type            &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E", "…</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; $ Unit                   &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe", "ktoe", "…</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; $ Flow                   &lt;chr&gt; "Production", "Production", "Imports", "I…</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; $ Product                &lt;chr&gt; "Primary solid biofuels", "Hydro", "Crude…</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; $ E.dot                  &lt;dbl&gt; 2088, 250, 916, 1, 21, 1, 18, -4, -4, -17…</span></a></code></pre></div>
</div>
<div id="load-a--csv-file-to-a-tidy-iea-data-frame" class="section level3">
<h3 class="hasAnchor">
<a href="#load-a--csv-file-to-a-tidy-iea-data-frame" class="anchor"></a>Load a <code>.csv</code> file to a tidy IEA data frame</h3>
<p>For simplicity, the above functions are rolled into <code><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df()</a></code>. <code><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df()</a></code> loads the sample data bundled with the package and converts it to a tidy IEA data frame, assuming default arguments for all functions.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">simple &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_tidy_iea_df.html">load_tidy_iea_df</a></span>()</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">complicated &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="st">"extdata"</span>, <span class="st">"GH-ZA-ktoe-Extended-Energy-Balances-sample.csv"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="dt">package =</span> <span class="st">"IEATools"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/iea_df.html">iea_df</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/rename_iea_df_cols.html">rename_iea_df_cols</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/remove_agg_memo_flows.html">remove_agg_memo_flows</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/use_iso_countries.html">use_iso_countries</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/augment_iea_df.html">augment_iea_df</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/tidy_iea_df.html">tidy_iea_df</a></span>()</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/all">all</a></span>(simple <span class="op">==</span><span class="st"> </span>complicated)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>At this point, the integrity of the IEA data can be checked.</p>
</div>
</div>
<div id="check-data-integrity" class="section level1">
<h1 class="hasAnchor">
<a href="#check-data-integrity" class="anchor"></a>Check data integrity</h1>
<p>The IEA extended energy balance data are usually close to balanced, but not quite. To check the integrity of the energy balances, use the <code><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances()</a></code> function. <code><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances()</a></code> adds several new columns to the IEA data frame, including:</p>
<ul>
<li>
<code>supply_sum</code> (the sum of all flows on the supply side of the ledger),</li>
<li>
<code>consumption_sum</code> (the sum of all flows on the consumption side of the ledger),</li>
<li>
<code>supply_minus_consumption</code> (the difference between supply and consumption),</li>
<li>
<code>balance_OK</code> (a logical telling whether the energy balance is acceptable), and</li>
<li>
<code>err</code> (supply sum when <code>consumption_sum</code> is <code>NA</code> or <code>supply_minus_consumption</code> when <code>consumption_sum</code> is not <code>NA</code>).</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">Tidy_IEA_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Country, Year, Energy.type, Product) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; Observations: 78</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; Variables: 9</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; Groups: Country, Year, Energy.type [4]</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; $ Country                  &lt;chr&gt; "GH", "GH", "GH", "GH", "GH", "GH", "GH…</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; $ Year                     &lt;chr&gt; "1971", "1971", "1971", "1971", "1971",…</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; $ Energy.type              &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E",…</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; $ Product                  &lt;chr&gt; "Aviation gasoline", "Charcoal", "Crude…</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; $ supply_sum               &lt;dbl&gt; 0, 119, 0, 236, 94, 219, 0, -1, 3, 18, …</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; $ consumption_sum          &lt;dbl&gt; NA, 119, NA, 235, 95, 217, NA, NA, 3, 1…</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; $ supply_minus_consumption &lt;dbl&gt; NA, 0, NA, 1, -1, 2, NA, NA, 0, 0, 1, 0…</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; $ balance_OK               &lt;lgl&gt; TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, …</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; $ err                      &lt;dbl&gt; 0, 0, 0, 1, -1, 2, 0, -1, 0, 0, 1, 0, 0…</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17">Tidy_IEA_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Country, Year, Energy.type, Product) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="../reference/tidy_iea_df_balanced.html">tidy_iea_df_balanced</a></span>()</a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p>Be sure to group the IEA data by appropriate variables before calling <code><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances()</a></code>. Grouping should be done on the <code>Product</code> column if per-product balances are desired. Typically, grouping is also done on <code>Country</code>, <code>Year</code>, <code>Energy.type</code>, <code>Last.stage</code>, etc. columns. Grouping should <em>not</em> be done on the <code>Flow</code> column or the <code>Ledger.side</code> column.</p>
<p>The following code demonstrates the difference between country-level balance calculations and product-level balance calculations.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Country-level balances</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">Tidy_IEA_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Country, Year, Energy.type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; Observations: 4</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; Variables: 8</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; Groups: Country, Year [4]</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; $ Country                  &lt;chr&gt; "GH", "GH", "ZA", "ZA"</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; $ Year                     &lt;chr&gt; "1971", "2000", "1971", "2000"</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; $ Energy.type              &lt;chr&gt; "E", "E", "E", "E"</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; $ supply_sum               &lt;dbl&gt; 2585, 5394, 33208, 55710</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; $ consumption_sum          &lt;dbl&gt; 2583, 5394, 33210, 55709</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; $ supply_minus_consumption &lt;dbl&gt; 2, 0, -2, 1</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; $ balance_OK               &lt;lgl&gt; FALSE, TRUE, FALSE, FALSE</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; $ err                      &lt;dbl&gt; 2, 0, -2, 1</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co"># Product-level balances within each country</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18">Tidy_IEA_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Country, Year, Energy.type, Product) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt; Observations: 78</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt; Variables: 9</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt; Groups: Country, Year, Energy.type [4]</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt; $ Country                  &lt;chr&gt; "GH", "GH", "GH", "GH", "GH", "GH", "GH…</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt; $ Year                     &lt;chr&gt; "1971", "1971", "1971", "1971", "1971",…</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt; $ Energy.type              &lt;chr&gt; "E", "E", "E", "E", "E", "E", "E", "E",…</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt; $ Product                  &lt;chr&gt; "Aviation gasoline", "Charcoal", "Crude…</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt; $ supply_sum               &lt;dbl&gt; 0, 119, 0, 236, 94, 219, 0, -1, 3, 18, …</span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt; $ consumption_sum          &lt;dbl&gt; NA, 119, NA, 235, 95, 217, NA, NA, 3, 1…</span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"><span class="co">#&gt; $ supply_minus_consumption &lt;dbl&gt; NA, 0, NA, 1, -1, 2, NA, NA, 0, 0, 1, 0…</span></a>
<a class="sourceLine" id="cb11-32" data-line-number="32"><span class="co">#&gt; $ balance_OK               &lt;lgl&gt; TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, …</span></a>
<a class="sourceLine" id="cb11-33" data-line-number="33"><span class="co">#&gt; $ err                      &lt;dbl&gt; 0, 0, 0, 1, -1, 2, 0, -1, 0, 0, 1, 0, 0…</span></a></code></pre></div>
<p>IEA data can be adjusted to perfect balance with the <code><a href="../reference/fix_tidy_iea_df_balances.html">fix_tidy_iea_df_balances()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># Country level balances</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">Tidy_IEA_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Country, Year, Energy.type, Unit, Product) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/fix_tidy_iea_df_balances.html">fix_tidy_iea_df_balances</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Country, Year, Energy.type, Unit) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>()</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; Observations: 4</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; Variables: 9</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; Groups: Country, Year, Energy.type [4]</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; $ Country                  &lt;chr&gt; "GH", "GH", "ZA", "ZA"</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; $ Year                     &lt;chr&gt; "1971", "2000", "1971", "2000"</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt; $ Energy.type              &lt;chr&gt; "E", "E", "E", "E"</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt; $ Unit                     &lt;chr&gt; "ktoe", "ktoe", "ktoe", "ktoe"</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt; $ supply_sum               &lt;dbl&gt; 2583, 5394, 33210, 55709</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt; $ consumption_sum          &lt;dbl&gt; 2583, 5394, 33210, 55709</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; $ supply_minus_consumption &lt;dbl&gt; 0, 0, 0, 0</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt; $ balance_OK               &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; $ err                      &lt;dbl&gt; 0, 0, 0, 0</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co"># Product-level balances within each country</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21">Tidy_IEA_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Country, Year, Energy.type, Unit, Product) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="st">  </span><span class="kw"><a href="../reference/fix_tidy_iea_df_balances.html">fix_tidy_iea_df_balances</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="st">  </span><span class="kw"><a href="../reference/calc_tidy_iea_df_balances.html">calc_tidy_iea_df_balances</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="st">  </span><span class="kw"><a href="../reference/tidy_iea_df_balanced.html">tidy_iea_df_balanced</a></span>()</a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
<div id="extract-matrices-for-psut-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#extract-matrices-for-psut-analysis" class="anchor"></a>Extract matrices for PSUT analysis</h1>
<div id="unit-summation-matrices-s_units" class="section level2">
<h2 class="hasAnchor">
<a href="#unit-summation-matrices-s_units" class="anchor"></a>Unit summation matrices (<code>S_units</code>)</h2>
<p>Unit summation matrices (<code>S_units</code>) can be extracted from a tidy data frame with the <code><a href="../reference/extract_S_units_from_tidy.html">extract_S_units_from_tidy()</a></code> function.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">S_units_mats &lt;-<span class="st"> </span>Tidy_IEA_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Country, Year, Energy.type) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/extract_S_units_from_tidy.html">extract_S_units_from_tidy</a></span>()</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">glimpse</a></span>(S_units_mats)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; Observations: 4</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt; Variables: 4</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; $ Country     &lt;chr&gt; "GH", "GH", "ZA", "ZA"</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; $ Year        &lt;chr&gt; "1971", "2000", "1971", "2000"</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt; $ Energy.type &lt;chr&gt; "E", "E", "E", "E"</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; $ S_units     &lt;list&gt; [&lt;matrix[14 x 1]&gt;, &lt;matrix[16 x 1]&gt;, &lt;matrix[21 x 1…</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11">S_units_mats<span class="op">$</span>S_units[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt;                                       ktoe</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; Aviation gasoline                        1</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt; Charcoal                                 1</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt; Crude oil                                1</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt; Electricity                              1</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; Fuel oil                                 1</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; Gas/diesel oil excl. biofuels            1</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; Hydro                                    1</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt; Kerosene type jet fuel excl. biofuels    1</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="co">#&gt; Liquefied petroleum gases (LPG)          1</span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co">#&gt; Lubricants                               1</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="co">#&gt; Motor gasoline excl. biofuels            1</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24"><span class="co">#&gt; Other kerosene                           1</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="co">#&gt; Primary solid biofuels                   1</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">#&gt; Refinery gas                             1</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co">#&gt; attr(,"rowtype")</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="co">#&gt; [1] "Product"</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co">#&gt; attr(,"coltype")</span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co">#&gt; [1] "Unit"</span></a></code></pre></div>
</div>
</div>
<div id="analyses" class="section level1">
<h1 class="hasAnchor">
<a href="#analyses" class="anchor"></a>Analyses</h1>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#getting-started">Getting started</a></li>
      <li><a href="#next-steps">Next steps</a></li>
      <li><a href="#check-data-integrity">Check data integrity</a></li>
      <li>
<a href="#extract-matrices-for-psut-analysis">Extract matrices for PSUT analysis</a><ul class="nav nav-pills nav-stacked">
<li><a href="#unit-summation-matrices-s_units">Unit summation matrices (<code>S_units</code>)</a></li>
      </ul>
</li>
      <li><a href="#analyses">Analyses</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Heun.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
