---
title: "Prepare for PSUT analysis"
author: "Matthew Kuperus Heun"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Prepare for PSUT}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(dplyr)
library(IEATools)
```

## Introduction

After loading IEA data and ensuring that the data are balanced 
(see (http://IEATools.html)),
the analyst can prepare for further work.
One option might be preparation 
for physical supply-use table (PSUT) analysis.
This vignette shows how to use the functions in the `IEATools` package
for that purpose.


## Extract matrices for PSUT analysis

### Unit summation matrices (`S_units`)

Unit summation matrices (`S_units`) can be extracted from 
a tidy data frame with the `extract_S_units_from_tidy()` function.

```{r}
library(dplyr)
library(IEATools)
Tidy_IEA_df <- load_tidy_iea_df()
S_units_mats <- Tidy_IEA_df %>% 
  group_by(Country, Year, Energy.type) %>% 
  extract_S_units_from_tidy()
glimpse(S_units_mats)
S_units_mats$S_units[[1]]
```


### Add `matnames` column



## Adjust primary production




## Specify source of product flows



## `prep_psut()` function