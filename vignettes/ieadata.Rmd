---
title: "IEAData"
author: "Matthew Kuperus Heun"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(dplyr)
library(magrittr)
```

## Introduction

`IEAData` is an `R` package that provides functions to analyze 
extended energy balance data from the 
[International Energy Agency (IEA)](https://www.iea.org).
The IEA's data are not free. 
But if you have access to the data, you can following the instructions in this vignette to 
analyze IEA data.


## Getting started

To get started, data must be obtained and pulled into an R data frame.

### Obtain IEA data

Purchase the IEA extended energy balances product from (http://data.iea.org).
Download the complete extended energy balance data for at least one country
in a .csv file format as the following figure.

```{r pressure, echo=FALSE, fig.cap="IEA extended energy balance data format.", out.width = '100%'}
knitr::include_graphics("figs/original_header.pdf")
```

Example data from two countries for two years are provided in the package.

```{r}
library(dplyr)
library(IEAData)
# Define the file location
IEA_path <- file.path("extdata", "GH-ZA-ktoe-Extended-Energy-Balances-sample.csv") %>% 
  system.file(package = "IEAData")
readChar(IEA_path, nchars = 251)
```


### Convert the IEA data into an R data frame

The extended energy balance data can be pulled directly into an `R` data frame 
by the `iea_df()` function. 

```{r}
IEA_data <- IEA_path %>% 
  iea_df()
IEA_data %>% head(5)
```


## Next steps

There are several reasons why teh data are not convenient for immediate use.

1. Column titles are SHOUTING.
2. The COUNTRY column contains full country names. 
It would be nicer if countries were identified by their [2-letter ISO codes](https://en.wikipedia.org/wiki/ISO_3166-1).
3. The demarcation between the supply and consumptions sides of the ledger is unclear to new users.
4. How data should be aggregated is unclear to new users. 
5. The data are not in [tidy format](https://doi.org/10.18637/jss.v059.i10).


### Fix column titles

To unshout the column titles, use the `rename_iea_df_cols()` function.
Names given by `rename_iea_df_cols()` are defaults assumed by other functions.

```{r}
IEA_data %>% 
  rename_iea_df_cols() %>% 
  head(5)
```

Note that the `rename_iea_df_cols()` function is used above without any arguments,
because the default arguments are correct for the extended energy balance data
as it arrives from the IEA.
However, both the old and new names can be specified as arguments.
If you despise capitals letters and vowels, you could do the following.

```{r}
IEA_data %>% 
  rename_iea_df_cols(new_country = "ctry", new_flow = "flw", new_product = "prdct")  %>% 
  head(5)
```


### Change to ISO countries

```{r}
IEA_data %>% 
  use_iso_countries() %>% 
  head(5)
```


### Remove aggregation and memo data

```{r}
IEA_data %>% 
  filter(Flow == "Total primary energy supply") %>% 
  head(5)
IEA_data %>% 
  remove_agg_memo_flows() %>% 
  filter(Flow == "Total primary energy supply")
```

### Convert to a tidy data frame





## Analyses


## Conclusion


Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold', fig.cap="My caption."}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
